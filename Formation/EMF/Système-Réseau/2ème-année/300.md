# 300 – Intégrer des services dans

# un réseau indépendant des

# plates fromes

## Rapport personnel

```
Version 1 du 24 janvier 2021
```
## Danilo Anzile

```
Module du 01 .0 9 .2020 au 29.10. 2020
```

## personnel

Table des matières I


personnel


personnel


personnel

- 1 Introduction Table des matières
   - 1.1 Objectif
- 2 Linux – Qu’est - ce que c’est
   - 2.1 Question à répondre
      - 2.1.1 Sur la base de vos recherches et lectures, rédigez un bref historique de Linux
      - distribution Linux 2.1.2 Qu’est-ce qu’une distribution Linux? Qu’est qui est inclus dans une
      - distribué? 2.1.3 Sous quel type de licence le système d’exploitation Ubuntu Linux est-il
      - 2.1.4 Les versions d’Ubuntu. Comment se nomment-t-elle? quelle version utiliser?
      - 2.1.5 Quelle est la durée de vie d’une version d’Ubuntu
      - utiliser? 2.1.6 Les versions de Debian. Comment se nomment-t-elles? Quelles versions
      - 2.1.7 Qu’est-ce que Raspbian?
      - 2.1.8 Et existe-t-il d’autres distributions Linux? Nommez quelques exemples
      - 2.1.9 Quels sont les caractéristiques principales d’un système d’exploitation Linux
      - 2.1.10 Qu’est-ce que le shell
- 3 Exercice
   - 3.1 Mise en place du PI
      - 3.1.1 Configuration ip
      - 3.1.2 Exemple de configuration
- 4 Exercice
- 5 Exercice
   - 5.1 Qu’est - ce que le sudo « user »
- 6 Utilisateurs et groupes
   - 6.1 Les commandes
   - 6.2 Exercice
- 7 Les permissions
   - 7.1 Catégorie de droit
      - 7.1.1 Utilisateur propriétaire
      - 7.1.2 Groupe propriétaire
      - 7.1.3 Les autres
   - 7.2 Les commandes
- 8 Gestion des disques
   - 8.1 Les commandes
   - 8.2 Exercice
   - 8.3 Exercice
- 9 Gestionnaire de paquets
   - 9.1 Liste commande......................................................................................................
   - 9.2 Définition Table des matières II
   - 9.3 Exercice
      - 9.3.1 A quoi sert un gestionnaire de paquets?
      - distribution Linux Debian et ses dérivées? 9.3.2 Comment se nomme le gestionnaire de paquets couramment utilisés dans la
      - 9.3.3 Qu’est-ce qu’un dépôt ?.................................................................................
      - 9.3.4 Où peuvent être localisés les dépôts? donnez des exemples.
      - 9.3.5 A quoi sert le fichier de configuration nommé /etc/apt/sources.list?
      - les applications et le système. 9.3.6 Nommer les outils en mode commande disponibles sous Debian pour gérer
      - commandes apt) et la commande dpkg. 9.3.7 Indiquez la différence fondamentale entre l’environnement apt (ensemble de
      - Linux. 9.3.8 Recherchez la commande qui vous permet de mettre à jour votre système
   - 9.4 Exercice
      - 9.4.1 #apt-get update
      - 9.4.2 #dpkg -l
- 10 Initialisation & démarrage système
      - 10.1.1 Planificateur de tâche
   - 10.2 Exercice
- 11 Service réseau..................................................................................................................
   - 11.1 Exercice
- 12 Service SSH → connexion à distance
   - 12.1 Comment configurer SSH pour chaque utilisateur
   - 12.2 Exercice
- 13 Serveur FTP
   - 13.1 Définition
   - 13.2 Client | Service
      - 13.2.1 Client
      - 13.2.2 Service
   - 13.3 Mode
      - 13.3.1 Anonymous
      - 13.3.2 Authentification
   - 13.4 Exercice
      - 13.4.1 Configuration fonctionnelle
- 14 Service DHCP
   - 14.1 Rappel fonctionnement
   - 14.2 Exercice
   - 14.3 Configuration DHCP
      - 14.3.1 Subnet
      - 14.3.2 Range
      - 14.3.3 Mask..............................................................................................................
      - 14.3.4 Broadcast
      - 14.3.5 Gateway
      - 14.3.6 Domain-name
      - 14.3.7 Bail Table des matières III
         - a) Durée par défaut
         - b) Durée Max
      - 14.3.8 IP Static
      - 14.3.9 Vérifier le DHCP
      - 14.3.10 Exemple complet
   - 14.4 Description des démarches
      - 14.4.1 Configuration par basique
      - 14.4.2 Configuration adresses IP fixes uniquement
- 15 Service DNS
   - 15.1 Qu’est - ce que c’est?
   - 15.2 Mode
      - 15.2.1 Récursif
      - 15.2.2 Itératif
   - 15.3 Configuration Bind9
      - 15.3.1 Emplacement du .conf
      - 15.3.2 Ajout d’un forwarder
      - 15.3.3 Ajout d’un répertoire pour situer la base de données
      - 15.3.4 Accès à la base de données
      - 15.3.5 Ajout des entrées dans la base de données
      - 15.3.6 Exemple
   - 15.4 Gestion de la base de données
      - 15.4.1 TTL
      - 15.4.2 SOA
         - a) <zone>
         - b) <nameserver>
         - c) <email admin>
         - d) <serialnumber>
         - e) <slave...>..................................................................................................
         - f) <negative TTL>
      - 15.4.3 Exemple de configuration
         - a) Serial
         - b) Refresh
         - c) Retry
         - d) Expire
         - e) Negative Cache TTL
      - 15.4.4 Type d’enregistrement
- 16 Xinetd (inetd)
   - 16.1 Qu’est - ce que c’est?
      - 16.1.1 /etc/services
      - 16.1.2 Exemple
   - 16.2 A contrôler...............................................................................................................
      - 16.2.1 Vsftpd
      - 16.2.2 Modification de la config
      - 16.2.3 Configuration xinetd
      - 16.2.4 Redémarrage
      - 16.2.5 Test
   - 16.3 Exercice
- 17 Service Table des matières IV
   - 17.1 Etape d’installation
      - 17.1.1 Update / install
      - 17.1.2 Sauvegarde
      - 17.1.3 Les logs
         - a) Login
      - 17.1.4 Suppression de commentaire inutile
- 18 Samba
   - 18.1 A quoi ça sert?
   - 18.2 Installation et configuration
      - 18.2.1 Installation
      - 18.2.2 Fichier de configuration
      - 18.2.3 [global]
      - 18.2.4 [<nomDePartage>]
         - a) Comment
         - b) Create mask
         - c) Directory mask
         - d) Path
         - e) Read only..................................................................................................
         - f) Valid users
      - 18.2.5 Test à effectuer
         - a) Windows
         - b) Smbclient
- 19 Conclusion
- 20 Source et lien utile


```
personnel
```
## 1 Introduction

### 1.1 Objectif

- Déterminer, à partir des prescriptions, les services nécessaires, en déduire les exi-
    gences de sécurité et de protection, et élaborer un concept pour l ́intégration des ser-
    vices.
- Configurer, organiser les clients et serveurs conformément aux prescriptions et vérifier le
    caractère fonctionnel exigé.
- Organiser les liaisons réseau, mettre en service et expérimenter les services. Vérifier les
    mesures définies de sécurité et de protection.
- Organiser, installer les applications et les outils et vérifier le caractère fonctionnel exigé,
    et intégrer les ressources communes.
- Le cas échéant, cerner et verbaliser systématiquement les erreurs, prendre les mesures
    de dépannage.
- Réaliser la documentation pour l’administration du réseau, les rôles et droits d’accès, les
    applications et les services intégrés.

## 2 Linux – Qu’est - ce que c’est

### 2.1 Question à répondre

#### 2.1.1 Sur la base de vos recherches et lectures, rédigez un bref historique de Linux

Linux ou GNU est une famille de systèmes d'exploitation open source de type Unix fondé sur le
noyau Linux, créé en 1991 par Linus Torvalds.

2.1.2 **Qu’est** - **ce qu’une distribution Linux? Qu’est qui**
est inclus dans une distribution Linux

Une distribution Linux est un système d'exploitation créé à partir d'une collection de logiciels uti-
lisant le noyau Linux/GNU. Dans la plupart des distributions, les logiciels disponibles sont libres,
développés en langage open source.

Voici un lien avec toutes les distributions ainsi que leur date de création. Clique ici.

2.1.3 **Sous quel type de licence le système d’exploita-**
tion Ubuntu Linux est-il distribué?

Ubuntu est basé sur la distribution Debian qui utilise le type de licence libre et open source.

#### 2.1.4 Les versions d’Ubuntu. Comment se nomment-t-elle? quelle version utiliser?

Les 2 versions à utiliser actuellement sont :

- Focal Fossa (20. 04 )
- Groovy Gorilla (20.10)

```
Version à venir en 202 1 :
```

```
personnel
```
- Hirsute Hippo (21.04)


```
personnel
```
#### 2.1.5 Quelle est la durée de vie d’une version d’Ubuntu

La durée de vie et d’environ 2 ans.

2.1.6 Les versions de Debian. Comment se nomment-t-
elles? Quelles versions utiliser?

Les versions encore utilisables sont la 9 qui est toujours prise en charge et la 10 qui est la ver-
sion actuelle.

#### 2.1.7 Qu’est-ce que Raspbian?

C’est le système d’exploitation d’un Raspberry qui utilise un noyaux linux.

2.1.8 Et existe-t- **il d’autres distributions Linux? Nom-**
mez quelques exemples

Oui il en existe des dizaines d’autre comme par exemple :

- Kali Linux
- Slackware Linux
- Red Hat
- Linux Mint


```
personnel
```
- Etc...

#### 2.1.9 Quels sont les caractéristiques principales d’un système d’exploitation Linux

Le shell (ou interface système en français) est un programme qui reçoit des commandes infor-
matiques données par un utilisateur à partir de son clavier pour les envoyer au système d'exploi-
tation qui se chargera de les exécuter.

#### 2.1.10 Qu’est-ce que le shell

C’est un programme qui est conçu pour recevoir des commandes et les exécutés.

## 3 Exercice 0

### 3.1 Mise en place du PI

#### 3.1.1 Configuration ip

```
#vim etc/netplan/ 01 - network-manager-all.yaml
```
#### 3.1.2 Exemple de configuration

```
network:
ethernets:
eth0:
dhcp4: no
addresses: [10.19. 1 .1 40 /15]
gateway4: 10.18.0.
nameservers:
addresses: [195.186.1.162, 195.186.4.162]
version: 2
```
Teste de la configuration :
**#netplan try**

Pour appliquer la configuration :
**#netplan apply**

## 4 Exercice 2

Déplacez-vous à la racine de l’arborescence de votre système de fichiers
**$cls -ld ../..**
Nommez les répertoires du premier niveau de votre arborescence. Réaliser un schéma de cette
arborescence dans votre RP

Allez dans le dossier /var/log
**$cd var/log**
Remontez d’un niveau
**$cd ..**
Retournez dans votre répertoire de connexion
**$cd ../home/myadmin**
Affichez à l’écran le chemin actuel (path)
**$pwd**


```
personnel
```
Installez la commande shell tree
**$sudo apt install tree**
Tester cette commande après vous être placé à la racine
**$tree**
Positionnez-vous dans votre répertoire de connexion
**$cd home/myadmin**

Créez à la racine de votre arborescence personnelle, un répertoire nommé data_usr et autre
nommé boot_files et encore data_var
**$mkdir data_usr**

Copiez dans data_usr tous les fichiers contenus dans l’arborescence de /usr
**$cp -r usr/* home/myadmin/data_usr**
Copiez dans boot_files l’arborescence complète de /boot (répertoire /boot compris)
**$sudo cp -r boot home/myadmin/boot_files**
Copiez dans data_var uniquement les fichiers localisés dans /var/log
**$sudo cp -r var/log/* home/myadmin/data_var**
Réalisez une copie de l’arborescence complète de votre répertoire data_usr dans data_usr
**$cp -r data_usr/* data_usr**

Renommez l’arborescence complète de data_usr2 en my_usr
**$mv data_usr2 my_usr**

Effacez dans votre répertoire boot_files le répertoire complet nommé boot
**$sudo rm -r boot_files/boot**

Dans votre arborescence personnelle, créez le plus efficacement possible les fichiers nommés
a b c d e f g h
**#touch “a”,”b”, ...**
Au moyen de la commande echo, ajoutez crez un fichier nommé firstfile contenant le texte «
mon premier fichier »
**#echo Mon premier fichier > firstfile**

Toujours avec la commande echo, ajoutez à la fin du fichier firstfile le texte « a deux lignes »
**#echo a deux lignes >> firstfile**
Indiquez la date de la dernière modification du fichier /var/log/syslog
**#stat /var/log/syslog**
Identifiez où se trouve dans le programme qui correspond à la commande cp et sa page ma-
nuelle
**#info -w cp && info cp**

De quel type est le fichier /dev/tty
**# file /dev/tty**

De quel type est le fichier /etc/passwd
**#file /etc/passwd**

## 5 Exercice 3

### 5.1 Qu’est - ce que le sudo « user »

Sudo pour super administrateur, permet à l’utilisateur d’avoir les droits d’administrateurs de la
machines.

## 6 Utilisateurs et groupes

### 6.1 Les commandes

```
Commande Description
```
**#useradd** (^) Permet de rajouter un utilisateur.


```
personnel
```
```
Attribut :
```
- - m → Force la création du répertoire
- - s → Permet de changer le pro-
    gramme de connexion.
- - D → Affiche les valeurs de défaut de
    l’environnement useradd.
- - g → Permet de changer le groupe
- - G → Groupe secondaire

**#userdel** (^) Permet de supprimer un user.
**#usermod** (^) Permet de modifier un utilisateur.
**#groupadd** (^) Permet l’ajout d’un groupe
**#groupmod** (^) Permet la modification d’un groupe
**#groupdel** (^) Permet la suppression d’un groupe
**#passwd [login];** (^) Il faut définir un mot de passe pour activer
l’utilisateur.
**#su – [user]** (^) Permet de prendre l’identité d’un user pour
effectuer des tests.

### 6.2 Exercice 5

Créez un compte nommé « administrateur » dont les droits sont identiques à ceux de root.
**#useradd -g 0 administrateur**
Lorsque cela fonctionne, trouvez comment désactiver le compte root (pour des raisons évi-
dentes de sécurité)
**#usermod -p ‘!’ root**
Créez à la racine du système un répertoire /projet
**#mkdir projet**

Créez un groupe nommé projet
**#groupadd projet**

Créez un utilisateur jean et un utilisateur pierre. Ces 2 utilisateurs font partie du groupe complé-
mentaire nommé « projet »
**#useradd -G pro jet -m pierre
#useradd -G projet -m jean**
Créez l’utilisateur ftp_admin dont le répertoire de connexion est /var/ftp
**#useradd -d /var/ftp -m ftp_admin**
Configurez les droits d’accès sur le répertoire /projet de sorte à ce que seuls les utilisateurs
pierre et jean aient accès en lecture et écriture à cette ressource.
**#chmod g+ws projet**

Dans le répertoire /projet, seul le créateur d’un fichier possède les droits de destruction
**#chmod o+t projet**

Resultat
**drwxrwxr-x 2 root projet 4096 Dec 16 07:36 projet**

## 7 Les permissions

### 7.1 Catégorie de droit

#### 7.1.1 Utilisateur propriétaire

L’utilisateur propriétaire de base est le créateur du document ou du dossier.

#### 7.1.2 Groupe propriétaire


```
personnel
```
Le groupe est aussi celui du propriétaire par défaut.

#### 7.1.3 Les autres

Ce sont les droits que tout autre utilisateur a sur le dossier ou document.

### 7.2 Les commandes

```
Commande Description
```
**#ls -l** (^) Afficher la liste des dossiers et documents
avec leur droit d’accès.
**#ls -al** (^) Afficher les droits de touts les dossiers et do-
cuments ainsi que ceux caché.
**#ll | grep “Dossier/fichier”** (^) Afficher les droits du fichier ou dossier choisi.
**#chown “utilisateur”:”Groupe”
“leDocument”**
Modifier le propriétaire du document ou dos-
sier.
**#chmod [ugoa] [+ - =] [rwx]
“Document”**
Permet de modifier les droits.
**#more /etc/passwd** (^) Pour afficher la base de données des utilisa-
teurs.
**#id “Utilisateur”** (^) Affiche les propriétés de l’utilisateur.
**|** (^) Pipeline, il permet de faire plusieurs com-
mandes à la suite.
**>** (^) Enregistrer dans un document
**>>** (^) Mettre à la suite du document
**$sudo su** (^) Se mettre en mode sudo

## 8 Gestion des disques

### 8.1 Les commandes

```
Commande Description
```
**#fdisk – -list** (^) Affiche la liste des disques
**#mkfs.** (^) Il permet de formater un disque.
Mkfs.(ext2,ext3)
**#cfdisk** (^) Permet d’afficher une table de partition sous
forme d’interface.
**#mount** (^) Permet de monter une partition sur un dos-
sier
**#umount** (^) L’inverse de mount.
**#blkid** (^) Permet d’identifier les blocks.

### 8.2 Exercice 7

1. Comment nomme-t-on disques et partitions sous Linux?


```
personnel
```
2. Quelle peut-être l’utilisation des disques et des partitions sur un système Linux?

Leur utilisation principale et en tant que système de fichiers mais on peut très bien l’utiliser
comme périphérique de stockage brut ou pour la sauvegarde.

3. Quelles commandes permettent de gérer et de configurer les disques?
    **#cfdisk**
4. Quelles commandes permettent de surveiller l’espace disque (p.ex. % d’occupation des péri-
phériques)?
    **#df**
5. L’arborescence de Linux. Reportez les répertoires du premier niveau et indiquez à quoi ils
servent.

```
/ → racine
/bin → commandes
/dev → les périphériques
/etc → Les fichiers de configuration
/home → Répertoire par défaut des utilisateurs
/lib → Library
/var → emplacement ou les logs sont stocker
```
6. Expliquez ce qu’est un point de montage?
Le montage utilisera le répertoire existant. Après le montage, tous les éléments de ce dossier se-
ront stockés sur la partition utilisée pour le montage.
7. Nommez les fonctions de gestion des systèmes de fichiers et indiquez à quoi elles servent.
    - mkfs → Make File Systems est une commande qui permet de formater un système de
       fichier.


```
personnel
```
- tune2fs
- e2fsck → Vérifier un système de fichiers Linux
- fsck
- resize2fs
8. Quels types de systèmes de fichiers est-il possible de monter dans une arborescence Linux?
- ext
- ext
- ext
- reiserFS
- fat
- fat
- NTFS
- exFat

### 8.3 Exercice 8

Avec fdisk, créez une partition primaire de 1Go, format du fs ext2 et une seconde partition qui
occupe le reste du disque en format ext3.
**#cfdisk -z /dev/sda
#mkfs.ext2 /dev/sda
#mkfs.ext3 /dev/sda**

Supprimer la seconde partition avec fdisk.
**#fdisk /dev/sda
#d
#
#w**
Sur le premier disque disponible (/dev/sda), recréez une partition principale de 2 Go.
**# cfdisk /dev/sda**
Créez clear
**# cfdisk /dev/sda**

Créez sur la partition de 2 Go un système de fichiers de type ext
**#mkfs.ext3 /dev/sda**

Créez sur la partition de 500Mo un système de fichiers ext
**#mkfs.ext4 /dev/sda 5**

Créez un répertoire /storage. Dans ce répertoire, créez les sous-répertoires suivants : P1, P2 et
P
**#cd /
#mkdir storage
#cd storage
#mkdir P1,P2,P**

Montez vos 3 partitions respectivement sous P1 (partition 1 Go), P2 (partition 2Go) et P3 (parti-
tion 500 Mo).
**#mount /dev/sda 1 /storage/P 1
#mount /dev/sda 2 /storage/P 2
#mount /dev/sda 5 /storage/P**

Automatisez le montage de ces 3 partitions
**#blkid /dev/sda1 >> etc/fstab
#blkid /dev/sda2 >> etc/fstab
#blkid /dev/sda 5 >> etc/fstab**


```
personnel
```
Sur la première partition de 1 Go, copiez l’arborescence complète de /var
**#cp -r /var /storage/P**

Transformez le système de fichiers de la partition de 1 Go en ext
**#tune2fs -j /dev/sda**

Transformez la partition de 2Go de ext3 à ext
**#umount /dev/sda2** → **démonter la partition
#tune2fs -O ^has_journal /dev/sda2** → **changement du type en ext
#e2fsck -y /dev/sda2** → **contrôle qu’il n’y ai pas d’érreur
#mount -t ext2 /dev/sda2 /storage/P2** → **remonter la partition**

Quel est l’espace encore disponible en blocs de 512octets sur la partition de 1 Go
**#df -B 512 /dev/sda**

Au moyen de l’une ou l’autre méthode décrite ci-dessus, diminuer la taille de la partition de
1Go. Assurez-vous que cette partition contient des données avant de procéder au redimension-
nement.
**# umount /dev/sda
# e2fsck -f /dev/sda
# resize2fs /dev/sda1 900M
# mount /dev/sda1 storage/P**

Vérifiez et testez que tout a bien fonctionné

## 9 Gestionnaire de paquets

### 9.1 Liste commande......................................................................................................

```
Commande Description
```
**#apt update** (^) Met à jour le cache apt. A faire chaque jour.
**#apt install** (^) Permet d’installer un paquet avec des pages
d’aides, fichier de config de base, library, ...
**#dpkg -i** (^) Installe uniquement le paquet choisis et n’ins-
talle pas les dépendances.
**#apt upgrade** (^) Met à jour le système.
**#apt dist-upgrade** (^)
**#apt list –upgradable** (^) Liste de tous les paquets qui peuvent être
mis à jour.
**#apt remove – -purge** (^) Supprimer un paquet avec toute les configs.
**#apt search** (^) Chercher un paquet qui contient un mot.
**#apt update & apt upgrade &** (^) Permet de mettre à jour le système en ar-
rière-plan.
**#dpkg -l** (^) Liste de tous les paquets installer sur la ma-
chine.
**#apt-cache showpkg** (^) Donne les détails du paquet


```
personnel
```
### 9.2 Définition

Un gestionnaire de paquets est un (ou plusieurs) outil(s) automatisant le processus d'installa-
tion, désinstallation, mise à jour de logiciels installés sur un système informatique. Le terme est
surtout utilisé pour les systèmes d'exploitation basés sur Unix, tels GNU/Linux. Ces derniers uti-
lisent dans leur majorité un gestionnaire de paquets, souvent fourni en standard. Ils permettent
de mettre à disposition simplement des milliers de paquetages lors d'une installation standard.

### 9.3 Exercice 10

#### 9.3.1 A quoi sert un gestionnaire de paquets?

Un gestionnaire de paquets permet d’installer, mettre à jour et désinstaller des paquets ou logi-
ciel.

9.3.2 Comment se nomme le gestionnaire de paquets
couramment utilisés dans la distribution Linux
Debian et ses dérivées?

Le gestionnaire de paquets le plus courant est nommé APT. Mais on a aussi la possibilité d’utili-
ser DPKG.

#### 9.3.3 Qu’est-ce qu’un dépôt ?.................................................................................

Un dépôt est un serveur qui contient plusieurs paquets(logiciels). Ces dépôts sont mis à notre
disposition pour réaliser des installations simples. Il existe quatre grands types de dépôt : le
main, restricted, universe et multivers. Ils sont aussi tenus à jours sur ce serveur c’est pourquoi
il faut faire des updates avant d’installer une application.

#### 9.3.4 Où peuvent être localisés les dépôts? donnez des exemples.

Il y a des dépôts dans la plupart des pays. Pour la suisse c’est .ch, pour l’Allemagne c’est .de,

#### 9.3.5 A quoi sert le fichier de configuration nommé /etc/apt/sources.list?

Ce fichier contient la liste des dépôts et les liens vers les sites internet pour y accéder.

9.3.6 Nommer les outils en mode commande dispo-
nibles sous Debian pour gérer les applications et
le système.

Il y a dpkg et l’environnement apt.

9.3.7 **Indiquez la différence fondamentale entre l’envi-**
ronnement apt (ensemble de commandes apt) et
la commande dpkg.

La grande différence est que APT va installer tous les paquets dont le système aura besoin
pour faire tourner l’application installé. Tant que dpkg ne vas qu’installer le paquet demandé.


```
personnel
```
9.3.8 Recherchez la commande qui vous permet de
mettre à jour votre système Linux.

```
#apt update
```
### 9.4 Exercice 11

#### 9.4.1 #apt-get update

apt-get [-asqdyfmubV] [-o=config_string] [-c=config_file] [-t=target_release] [-a=architecture]
{update | upgrade | dselect-upgrade | dist-upgrade | install pkg [{=pkg_version_number | /tar-
get_release}]... | remove pkg... | purge pkg... |
source pkg [{=pkg_version_number | /target_release}]... | build-dep pkg [{=pkg_ver-
sion_number | /target_release}]... | download pkg [{=pkg_version_number | /target_release}]...
| check | clean | autoclean | autoremove | {-v | --version} |
{-h | --help}}

#### 9.4.2 #dpkg -l

dpkg [option...] action

2. Mettez à jour votre système d’exploitation Linux
    **#apt update & apt upgrade &**
3. Contrôler les dépôts. Ne définir que les dépôts officiels
    **#vim etc/apt/services.list**


```
personnel
```
4. Vérifiez si les applications (services) suivantes sont installées sur votre système. Si ce n’est
pas le cas, installez-les :

A faire avant d’installer un paquet :
**#apt update**

a. Serveur DNS (named)
**#apt -l | grep bind
#apt install bind**
b. Serveur dhcp
**#dpkg - l | grep dhcp
#apt install isc-dhcp-server**
c. Serveur ftp
**#dpkg -l | grep vsftpd
#apt install vsftpd**
d. Serveur Samba
**#dpkg -l | grep samba
#apt install samba**
e. Serveur Apache
**#dpkg -l | grep apache
#apt install apache**
f. Navigateur Lynx
**#dpkg -l | grep lynx
#apt install lynx**
5. Installez toutes les applications mentionnées ci-dessus. Contrôlez si l’application a bien été
Installée

6. Dé-installez complètement le serveur Apache. Rien de doit subsister en lien avec ce service
dans votre système
**#apt remove –-purge apache**
7. Localisez le cache local de votre machine qui contient les applications installées sur votre
machine.
#cd etc
8. Recherchez les informations détaillées concernant le paquet dhcp-server
**#apt-cache showpkg dhcp**


```
personnel
```
9. Nettoyez votre cache local de sorte à ce qu’il ne contienne que les applications installées sur
votre machine.
**#apt autoclean**
10. Déterminez combien de paquetages sont installés sur votre machine.
**#dpkg - l | wc -l**
11. Nettoyer le cache local de votre machine. Décrivez à quoi sert cette fonction.
**#apt clean** → **Permet de supprmier tout le cache**

12. Déterminez les dépendances liées à l’application qui implémente le serveur DNS.
**#apt-cache showpkg bind**

## 10 Initialisation & démarrage système

```
Commande Description
```
**#systemctl stop <service>** (^) Permet d’arrêter un service
**#systemctl start <service>** (^) Démarrer un service
**#systemctl status <service>** (^) Permet de voir l’état d’un service
**#reboot** (^) Redémarrer système
**#halt** (^) Stop système
**#systemctl reboot** (^) Redémarrer système
**#systemctl poweroff** (^) Stop système
**#systemctl list-unit-files –-
type service – -state enable**
Liste des services qui sont en cours d’exécu-
tion.
**#ps - ef
#top**
Liste de tous les processus qui s’exécute sur
la machine.
**#systemctl disable <service>** (^) Désactiver un service
**#crontab -e** (^) Ouvrir le planificateur de tâche
**#cd var/log/syslog** (^) Emplacement des journaux ou logs.
**#journalctl - u <service>** (^) Permet d’afficher les logs d’un service spéci-
fique.
**#tail -50 syslog** (^) Prend les derniers 50 logs
**#tail -f syslog** (^) Affiche en temps réel des logs


```
personnel
```
```
#Shutdown [OPTIONS] [HEURE]
[MESSAGE]
```
```
Permet d’arrêter le système a un moment
précis en envoyant un message à l’utilisateur.
```
#### 10.1.1 Planificateur de tâche

Pour y accéder il faut taper la commande « #crontab -e » puis écrire m h dom mon dow com-
mand soit « minute », « heure », « jour du mois », « mois », « jour de la semaine » et la com-
mande.

### 10.2 Exercice 12

1. Vous devez procédez à des tâches d’administration système (p.ex. vous allez installer un
nouveau périphérique). Provoquez l’arrêt du système dans 5 minutes. Tous les utilisateurs doi-
vent recevoir le message « arrêt pour mise à jour hardware dans 5 minutes ».
    **#shutdown +5 "arrêt pour mise à jour hardware dans 5 minutes."**
2. Installez les services vsftpd et apache2. Identifier comment ces services démarrent lors de
l’initialisation du système. Justifiez votre réponse.
    **#apt install vsftpd**
    **#apt install apache**
3. Recherchez la commande qui vous permet de savoir quels processus s’exécutent sur votre
système. Plusieurs possibilités comme exposé dans la partie explications.
    **# systemctl list-units –all**
4. Vérifiez, au moyen de la commande précédente si les serveurs ssh et vsftpd s’exécutent sur
votre machine
    **# systemctl list-units --all | grep ssh**
    **# systemctl list-units --all | grep vsftpd**
5. Arrêtez les serveurs apache2 et ftp (vsftpd). Pour le faire, identifiez plusieurs moyens
    **#systemctl status apache**
    **#systemctl status vsftpd**
6. Au moyen de cron, mettez à jour votre cache APT tous les jours à 20 : 00
    **#crontab -e**

7. Configurez votre système de sorte que le service apache2 ne démarre pas au boot du sys-
tème
**#systemctl disable apache**

## 11 Service réseau..................................................................................................................

```
Commande Description
```
**#networkctl status** (^) Permet de récolter plusieurs informations par
rapport au réseau.
**#ifconfig -a** (^) Fonctionnel sur toute machines linux contrai-
rement au networkctl.

### 11.1 Exercice 13

1. Identifiez le nom de vos interfaces réseau


```
personnel
```
2. Configurez votre service réseau de sorte à ce que
a. l’interface connectée sur le switch de type « host only » reçoive les paramètres de
configuration automatiquement.

```
b. l’interface connectée sur le switch de type « nat » soit configuré manuellement, res-
pectez l'adresse de sous-réseau VMWARE
```
3. Montez vos interfaces réseau (ou redémarrez) le service
**#networkctl reload**

4. Configurez la passerelle par défaut ainsi que l’adresse du serveur DNS. Pour rappel le
host_id 2 est votre passerelle et serveur DNS sous VMWARE


```
personnel
```
5. Vérifiez que vous avez accès à internet au moyen de la commande nslookup (p.ex. nslookup
[http://www.emffr.ch)](http://www.emffr.ch))

## 12 Service SSH → connexion à distance

```
Commande Description
```
**Ssh-keygen** (^) Génère une clé publique et une clé priver sur
windows 10

### 12.1 Comment configurer SSH pour chaque utilisa-

### teur

En premier lieu, il faut utiliser la commande ssh-keygen sur la machine Windows 10 pour géné-
rer une clé publique et clé priver. Ensuite dans le répertoire de l’utilisateur sur Ubuntu, il y a un
dossier masqué nommé .ssh et à l’intérieur un document authorized_key ou il faut y mettre la
clé publique produite pas Windows. Pour terminer, il faut interdire le login par mot de passe et
autoriser le login par clefs dans /etc/ssh/sshd_config.

### 12.2 Exercice 14

1. Modifiez la configuration de sorte à interdire de se connecter en root avec ssh
    **#vim sshd_config**
2. Générez la paire de clefs sur la station cliente (a choix, station Linux, Windows ou Mac
    OS X). Utilisez l’algorithme RSA.


```
personnel
```
3. Transférez la partie publique de votre clef sur le serveur
    **PS C:\Users\AnzileD\.ssh> scp id_rsa.pub ubuntu@10.19.1. 140 :/home/ubuntu**
    **# cat id_rsa.pub >> .ssh/authorized_keys**
4. Modifiez votre configuration de sorte à interdire l’authentification par mot de passe (pour
    les connexions ssh bien entendu)
    **# cd /etc/ssh**
    **# vim sshd_config**

## 13 Serveur FTP

```
Configuration vsftpd.config Description
```
**$chroot_local** (^)
**$userlist_enable = YES** (^) Permet de faire une liste des utilisateurs
autorisé a utilisé le service FTP.
**$user_file = « fichier »** (^)

### 13.1 Définition

FTP soit File Transfer Protocole, il permet de mettre à disposition un espace de stockage à dis-
tance. L’inconvenant c’est qu’il n’est pas crypté que ce soit lors du login ainsi que durant le
transfère. L’avantage c’est que c’est simple à mettre en place.

### 13.2 Client | Service

#### 13.2.1 Client

- Filezilla
- Navigateur intrenet
- Explorateur windows
- ...

#### 13.2.2 Service

- Proftpd (Linux)
- Vsftpd (Linux)


```
personnel
```
### 13.3 Mode

#### 13.3.1 Anonymous

Permet l’accès sans aucune authentification. (Read Only or Read Write)

#### 13.3.2 Authentification

Donne l’accès à des données avec une authentifications. (Read Only or Read Write)

### 13.4 Exercice 15

1. Installez le serveur vsftpd sur votre machine. Repérez le fichier de configuration du service.
    **/etc/vsftpd.conf**
2. Configurez le service de sorte à interdire les accès anonymes
    **$vim etc/vsftpd.conf**
    →
3. Seuls les utilisateurs pierre, paul et marie peuvent s’authentifier avec le service ftp. Vous de-
vez également faire en sorte qu’un utilisateur connecté par ftp ne puisse pas naviguer dans l’ar-
borescence d’un autre utilisateur. Les utilisateurs doivent pouvoir uploader des données.

```
$vim etc/vsftpd.conf
```
```
$vim etc/ftpusers
```
4. Quel fichier de log pouvez-vous consulter pour identifier quels utilisateurs se sont connectés
au moyen du service ftp?

7. Vérifiez que vous n’avez pas accès aux contenus des autres utilisateurs via ftp.
**chroot_local_users=YES**

#### 13.4.1 Configuration fonctionnelle


```
personnel
```
## 14 Service DHCP

### 14.1 Rappel fonctionnement

### 14.2 Exercice 17

1. Installez le serveur dhcp sur votre machine (celui de isc.org)
    **#apt install isc-dhcp-server**
2. Configurez votre serveur DHCP avec les options suivantes :
    **#vim etc/dhcp/dhcpd.conf**
       a. Nom de domaine : module300.local
    **option domain-name « module300.local » ;**
       b. Serveur DNS : adresse ip des serveurs DNS que vous allez mettre en place
    **option domain-name-server 192.168.1.140 ;**
       c. Passerelle : adresse ip de la passerelle de votre sous-réseau sur emfnet
    **option routers 192.168.1.2**
       d. Sous-réseau, conforme à l’adresse de votre sous- Définissez une attribution
       d’adresse par plage (range), host_id 10 à 20.
    **range 192.168.1.10 192.168.1.20 ;**
       e. Définissez une attribution d’adresse par réservation, hos_id 30, pour la
       @mac 00 :0c :29 :24 :55 :55 (testez avec une VM)
    **Host clientTest{**
    **hardware ethernet 00:0c:29:24:55:55;**
    **fixed-address 192.168.1.30 ;**
    **}**
       f. Définissez des baux courts (quelques minutes)
    **default-lease-time 120 ;**
    **max-lease-time 600 ;**

3. Sur le serveur, contrôlez que vous retrouvez bien la référence des stations clientes dans le
fichier de baux
**vim /var/lib/dhcp/dhcpd.leases**


```
personnel
```
### 14.3 Configuration DHCP

#### 14.3.1 Subnet

```
subnet <subnet> netmask <masque>{}
```
#### 14.3.2 Range

```
range <première adresse> <dernière adresse>
```
#### 14.3.3 Mask..............................................................................................................

```
option subnet-mask <masque>
```
#### 14.3.4 Broadcast

```
option broadcast-address <broadcast>
```
#### 14.3.5 Gateway

```
option routers <addresse du routeur>
```
#### 14.3.6 Domain-name

```
option domain-name-servers <adresse>
```
14.3.7 Bail

##### a) Durée par défaut

```
default-lease-time <time>
```
##### b) Durée Max

```
Max-lease-time <7200>
```
#### 14.3.8 IP Static

```
host <hostName>{
hardware ethernet <MAC adresse>
fixed-address <adresse statique>
}
```
#### 14.3.9 Vérifier le DHCP

```
dhcpd -t -cf /etc/dhcp/dhcpd.conf
```
#### 14.3.10 Exemple complet


```
personnel
```
### 14.4 Description des démarches

#### 14.4.1 Configuration par basique

```
default-lease-time 600;
max-lease-time 7200;
option subnet-mask 255.255.255.0;
option broadcast-address 192.168.1.255;
option routers 192.168.1.254;
option domain-name-servers 192.168.1.1, 192.168.1.2;
option domain-name "ubuntu-fr.lan";
option ntp-servers 192.168.1.254;
```
```
subnet 192.168.1.0 netmask 255.255.255.0 {
range 192.168.1.10 192.168.1.100;
range 192.168.1.150 192.168.1.200;
}
```
#### 14.4.2 Configuration adresses IP fixes uniquement

```
deny unknown-clients;
#interdit l'attribution d'une adresse IP à une station dont l'adresse MAC
#est inconnue du serveur
```
```
subnet 192.168.1.0 netmask 255.255.255.0 {
host client1 {
hardware ethernet DD:GH:DF:E5:F7:D7;
fixed-address 192.168.1.20;
}
host client2 {
```

```
personnel
```
```
hardware ethernet 00:JJ:YU:38:AC:45;
fixed-address 192.168.1.21;
}
}
```
## 15 Service DNS

### 15.1 Qu’est - ce que c’est?

Le DNS permet de traduire un nom en une adresse IP ou vice versa trouver un nom par rapport
à son adresse IP. Un DNS est une base de données qui stocke chacune de ses adresses avec
son nom.

### 15.2 Mode

#### 15.2.1 Récursif

Il donne le nom d’autre serveur s’il ne parvient pas à trouver la réponse

#### 15.2.2 Itératif

Il donne lui-même une réponse complète.

### 15.3 Configuration Bind9

#### 15.3.1 Emplacement du .conf

```
#vim /etc/bind/named.conf.option
```
#### 15.3.2 Ajout d’un forwarder

```
forwarders {
[Adresse ip];
[Adresse ip];
};
```
15.3.3 **Ajout d’un répertoire pour** situer la base de don-
nées

```
directory <chemin>
```
#### 15.3.4 Accès à la base de données

```
/etc/bind/named.conf.local
```
#### 15.3.5 Ajout des entrées dans la base de données

```
zone <zoneName> IN {
type master;
file <DB path>;
};
```
#### 15.3.6 Exemple


```
personnel
```
### 15.4 Gestion de la base de données

```
/var/cache/bind
```
#### 15.4.1 TTL

```
#TTL <secondes de vie>
#TTL <jours de vie>D
```
#### 15.4.2 SOA

```
< zone> IN SOA <nameserver> <e-mail admin> (
<serialnumber>
<SlaveRefresh>
<SlaveRetry>
<SlaveExpire>
<negative TTL>
)
```
##### a) <zone>

Corresponds au FQDN de la zone.

##### b) <nameserver>

Corresponds au FQDN du serveur DNS

##### c) <email admin>

Il sert à contacter le créateur du fichier.

##### d) <serialnumber>

C’est un numéro sans signification, il est composé de la date + version.

##### e) <slave...>..................................................................................................

Ses différentes options s’appliquent à un esclave s’il y en a un. Elles décrivent à quelle fré-
quence les différentes opérations doivent être effectuées.

##### f) <negative TTL>


```
personnel
```
Compte pendant combien de temps le serveur doit conserver une requête qui n’a pas réussi
dans le cache du DNS.

#### 15.4.3 Exemple de configuration

##### a) Serial

Corresponds « version ».

##### b) Refresh

Tous les « X » secondes, il va demander au serveur master les nouvelles informations.

##### c) Retry

Si sa à pas marcher il ressaye.

##### d) Expire

Après un certain temps après avoir fait des refresh et que le serveur ne répond pas, il efface la
zone sur son serveur et ne répondra plus aux requêtes car il ne sait pas s’ils sont encore va-
lables ou pas.

##### e) Negative Cache TTL

Durant ce laps de temps, le serveur va garder son cache de ftp et dira que le ftp n’est pas dis-
ponible.

#### 15.4.4 Type d’enregistrement

- SOA → Démarrer la configuration
- NS → Le ou les serveurs de la zone en question
- A → Nom attribué à une adresse IPV4
- AAAA → Nom attribué à une adresse IPV6
- CNAME → Alias d’un enregistrement (Résolution de nom)


```
personnel
```
## 16 Xinetd (inetd)

```
Commandes utiles Description
```
➢ **/var/log/syslog** (^) Permet de purger les syslog

### 16.1 Qu’est - ce que c’est?

C’est un service qui permet de démarrer les services à la demande. Il identifie les ports qu’il re-
çoit et contrôle dans son fichier de configuration, s’il a distingué le port et va démarrer le service
en question. Lorsque la connexion s’arrête, Xinetd va éteindre le service.

#### 16.1.1 /etc/services

Liste de tous les services ainsi que leur port.
**ftp 21**

#### 16.1.2 Exemple

Il reçoit le port 21 (ftp) en entrer, il contrôle dans son fichier de configuration et démarrer le ser-
vice vsftpd. Lorsque la connexion s’arrête, Xinetd envoie un stop au service vsftpd. (Il faut confi-
gurer aussi vsftpd pour qu’il ne démarre pas au démarrage.)

### 16.2 A contrôler...............................................................................................................

#### 16.2.1 Vsftpd

Il faut être sûr que le service fonctionne correctement de manière autonome.

#### 16.2.2 Modification de la config

Il faut modifier la configuration de vsftpd →LISTEN.

#### 16.2.3 Configuration xinetd

Il faut configurer Xinetd pour vsftpd.
**Service ftp{
Disable=no
Port=21
Protocol=TCP
Server=/usr/sbin/vsftpd
User=root
}**

#### 16.2.4 Redémarrage

Il faut redémarrer xinetd. Pour être sûr que le service et bien fonctionnel, à la fin du redémar-
rage il affiche un message comme « 1 available service ».

#### 16.2.5 Test

Pour essayer il faut :
**a) #ps-ef | grep vsftpd
b) établir la connexion FTP**


```
personnel
```
```
c) couper la connexion.
```
### 16.3 Exercice 16

1. Arrêtez votre serveur ftp
**#systemctl stop vsftpd**
2. Installez (si nécessaire) xinetd et configurez
**#apt install xinetd
#cp xinetd.conf xinetd.conf.save
#vim /etc/xinetd.d/ftp**
a. xinetd pour que celui-ci gère vsftpd

```
b. vsftpd pour que celui-ci ne démarre plus au démarrage de la machine.
#systemctl disable vsftpd
```
3. Déterminer, selon votre configuration, ce que vous devez faire soit au niveau des rc (run
commands) ou au niveau des jobs upstart pour que vsftpd ne démarre pas lors du démarrage
de votre machine. Justifiez votre réponse.
Il faut juste effectuer la commande du point 2b, le service ftp ne va plus se démarrer automati-
quement mais uniquement lorsque le service xinet l’appelle.
4. Contrôlez dans les logs que le service ftp est bien disponible (available) via xinetd.
Reporter dans votre RP la partie du fichier de log correspondant.

5. Démarrez le service xinetd.
**#systemctl start xinetd**

6. Contrôlez que le processus correspondant au service xinetd s’exécute et vérifiez que le ser-
vice ftp ne s’exécute pas.


```
personnel
```
7. Lancez depuis un client de votre choix, une requête ftp.

8. Vérifiez que le processus correspondant au service ftp s’exécute.

9. Vérifiez que les fonctions de votre serveur ftp s’exécutent correctement

10. Quittez ftp
11. Vérifiez que le processus correspondant à ftp

## 17 Service

### 17.1 Etape d’installation

#### 17.1.1 Update / install

Avant de commencer l’installation, il faut mettre à jour le cache apt.
**#apt update
#apt install <package>**

#### 17.1.2 Sauvegarde

Avant de commencer la configuration, il faut sauvegarder le document de base avec un .save à
la fin.
**#cp /etc/<service>.conf /etc/<service>.conf.save**

#### 17.1.3 Les logs

Pour accéder au log du système :
**/var/log/syslog**
Purger les logs système :
**#> /var/log/syslog**
Pour affichier les logs


```
personnel
```
```
#more /var/log/syslog
OU
#journalctl <service>
OU
#tail -<nbr de ligne> /var/log/syslog
```
##### a) Login

```
/var/log/auth.log
```
#### 17.1.4 Suppression de commentaire inutile

```
#grep -v ^\#<fichierConfig>.conf
```
```
# grep -v ^\#<fichierConfig>.conf > <fichierConfig>.conf.1
```
```
→ Permet de prendre les lignes qui n’ont pas de commentaire et les
enregistrer dans un document à part.
```
```
#mv <fichierConfig>.conf.1 <fichierConfig>.conf
```
## 18 Samba

### 18.1 A quoi ça sert?

Il permet de faire des partages de fichiers.

### 18.2 Installation et configuration

#### 18.2.1 Installation

```
#apt update
#apt install samba → gère les partages
nmbd → Il s’installe automatique avec samba émulateur de netbios
```
#### 18.2.2 Fichier de configuration

```
/etc/samba/smbd.conf
```
#### 18.2.3 [global]

Il ne faut pas toucher à cette partie.

#### 18.2.4 [<nomDePartage>]

##### a) Comment

Permet de nommer un partage.


```
personnel
```
##### b) Create mask

Définit le masque des fichiers.

##### c) Directory mask

Définit le masque des dossiers.

##### d) Path

Définit l’emplacement du partage.

##### e) Read only..................................................................................................

Demande si on a le droit d’écrire dans le partage.
**Read only = no** → **on peut écrire
Read only = yes** → **on ne peut pas écrire**

##### f) Valid users

Permet de définir les utilisateurs ayants accès au partage.
**Valid users = @<Groupe>**

#### 18.2.5 Test à effectuer

Avant d’effectuer la connexion il faut faire la commande :
**#smbpasswd -a <username>**

Cette commande permet de rajouter un utilisateur avec le mot de passe qui veulent se connec-
ter depuis une machine windows.

##### a) Windows

On peut créer une machine virtuelle et essayé le partage.

##### b) Smbclient

On peut utiliser la commande #smbclient.

## 19 Conclusion

Durant ce module, nous avons pu apprendre les bases sur l’univers de Linux. Sa a été un mo-
dule très intéressant qui a pu poser de bonne base sur le fonctionnement du système d’exploi-
tation Ubuntu.

## 20 Source et lien utile

Photo page de garde : https://images.app.goo.gl/VUtqUihWneJCQxnm7
Configuration de netplan : https://doc.ubuntu-fr.org/netplan
Configuration de xinetd : [http://web.mit.edu/rhel-doc/4/RH-DOCS/rhel-rg-fr-4/s1-tcpwrappers-](http://web.mit.edu/rhel-doc/4/RH-DOCS/rhel-rg-fr-4/s1-tcpwrappers-)
xinetd-config.html
Configuration de bind9 : https://clement-pelleau.fr/2019/10/mettre-en-place-un-serveur-dns-
avec-bind9/
Configuration de dhcp : https://guide.ubuntu-fr.org/server/dhcp.html


