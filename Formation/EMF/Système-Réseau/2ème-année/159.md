# 159 – Configurer et synchroni-

# ser le service d’annuaire

## Rapport personnel

```
Version 1 du 27 août 2021
```
## Danilo Anzile

Module du 18 .0 5 .202 1 au 16. 06. 2021


## Table des matières I




- 1 Introduction Table des matières
- 2 Annuaire
   - 2.1 Qu’est - ce que c’est?
      - 2.1.1 Exemple
   - 2.2 Un annuaire électronique
      - 2.2.1 Qu’est-ce que c’est?
   - 2.3 Données d’entreprises et annuaire
   - 2.4 Données d’entreprises
      - 2.4.1 Données de production
      - 2.4.2 Données non structurées, connaissances
      - 2.4.3 Données référence
   - 2.5 Objectifs de mise en place d’un annuaire
   - 2.6 Comparatif annuaire et base de données
   - 2.7 Exemple de données
   - 2.8 Caractéristiques des annuaires
   - 2.9 Exemple d’annuaire (DNS)
   - 2.10 Le standard LDAP
      - 2.10.1 DIT (Directory Information Tree)
      - 2.10.2 DIB (Directory Information Base)
- 3 Exercice
   - 3.1 Installation du serveur LDAP
   - 3.2 Créer un annuaire
   - 3.3 L’ajout d’entrée
      - 3.3.1 Création d’un fichier config.ldif
      - 3.3.2 Appliquer la config
      - 3.3.3 Contrôle et résolution de problème
- 4 Exercice 2a
   - 4.1 ApacheDirectoryStudio
      - 4.1.1 Documentation
      - 4.1.2 Sources
      - 4.1.3 Procédures d’installation..................................................................................
   - 4.2 Phpldapadmin
      - 4.2.1 Documentation
      - 4.2.2 Sources
   - 4.3 JXplorer
      - 4.3.1 Documentation
      - 4.3.2 Sources
   - 4.4 LDAP admin
      - 4.4.1 Documentation
      - 4.4.2 Sources
   - 4.5 Consigne
      - 4.5.1 Nouveau document add_content.ldif..............................................................
   - 4.6 Ajouter Table des matières II
      - 4.6.1 Commande
      - 4.6.2 Résultat
   - 4.7 Modifier
      - 4.7.1 Ajouter une modification
      - 4.7.2 Appliquer les modifications
   - 4.8 Remplacer
      - 4.8.1 Commande
   - 4.9 Supprimer
      - 4.9.1 Commande
   - 4.10 Fonctionnement ADS
      - 4.10.1 Connection
      - 4.10.2 Options disponibles
      - 4.10.3 Ajouter à l’aide d’apache
      - 4.10.4 Supprimer à l’aide d’apache
      - 4.10.5 Console
- 5 Exercice 2b
   - 5.1 Ajout d’un nouveau module
      - 5.1. 1 Ajout d’un module HDB
      - 5.1.2 Commande
   - 5.2 Ajout d’un DIT
      - 5.2.1 Commande
   - 5.3 Organisation du DIT
      - 5.3.1 Ajout des diverses données dans le nouveau DIT
- 6 Exercice 3b
   - 6.1 Mise en place de la réplication (dc=garages,dc=ch)
      - 6.1.1 Configuration du provider
      - 6.1.2 Commande
      - 6.1.3 Configuration du consumer
         - a) La BD
         - b) Synchronisation du service
      - 6.1.4 Test de la synchronisation
- 7 Exercice 3d
   - 7.1 La délégation LDAP
      - 7.1.1 Fonctionnement
         - a) Referral
         - b) Referral + Chaining
   - 7.2 Ajout d’une nouvelle BD et d’un DIT
      - 7.2.1 Création base de données
         - a) Commande
      - 7.2.2 Création du DIT
         - a) Commande
   - 7.3 Ajouter une nouvelle localité
   - 7.4 Ajouter des nouveaux utilisateurs et une OU
      - 7.4.1 Commande
   - 7.5 Indiquer la référence
      - 7.5.1 Commande
   - 7.6 Le chainage Table des matières III
      - 7.6.1 Ajouter le module...........................................................................................
         - a) Commande
      - 7.6.2 Mise en place
         - a) Commande
      - 7.6.3 Slapd
         - a) Arrêt du service
         - b) Import du fichier ldif
         - c) Suppression d’une entrée
         - d) Modification des permissions
         - e) Démarrage du service
      - 7.6.4 Test
- 8 Exercice 3e
   - 8.1 Etape pour répliquer un nouveau DIT
      - 8.1.1 Syncprov (provider)
         - a) Commande
      - 8.1.2 Configuration du syncprov
         - a) Commande
      - 8.1.3 Lien avec le consumer
         - a) Commande qui permet de trouver la DB
         - b) Commande execution
   - 8.2 Réplication de l’arbre cn=config vers le consumer
      - 8.2.1 Commande
- 9 Exercice
   - 9.1 Ajout du contenu
      - 9.1.1 Commande
   - 9.2 Ajout de l’acl
      - 9.2.1 Commande
- 10 Synchroniser les serveurs avec ntp
- 11 Recherche dans LDAP
   - 11.1 Mise en place de la commande
   - 11.2 Anonyme
   - 11.3 Avec utilisateur
- 12 Exercice supplémentaire
- 13 Répliquer un service d’annuaire
   - 13.1 Concept
      - 13.1.1 But
      - 13.1.2 Référence
      - 13.1.3 Composant Openldap
      - 13.1.4 Information importante
   - 13.2 Modes de réplication
- 14 Configurer un referral
   - 14.1 Concept
   - 14.2 Fonctionnements possibles
   - 14.3 Mise en place
      - 14.3.1 Exemple de DIT
      - 14.3.2 DIT referral Table des matières IV
      - 14.3.3 Explication
   - 14.4 En résumé
- 15 ACL
   - 15.1 Concept ACL
      - 15.1.1 But
      - 15.1.2 Composant
      - 15.1.3 Notion importante
   - 15.2 Concept Limite
      - 15.2.1 But
      - 15.2.2 Composant
   - 15.3 Concept index
      - 15.3.1 But
      - 15.3.2 Syntaxe à respecter :
      - 15.3.3 À faire attention
   - 15.4 Rappelle arborescence cn=config
   - 15.5 Element de syntaxe
      - 15.5.1 Exemple
      - 15.5.2 olcAccess
      - 15.5.3 To <xxx>
      - 15.5.4 By <zzz>
      - 15.5.5 <droit>
   - 15.6 Règle d’utilisation
   - 15.7 Exemple d’interprétation d’ACLs par slapd
   - 15.8 Sur quoi donne t’on les droits?
      - 15.8.1
      - 15.8.2
   - 15.9 A qui donne-t-on des droits?
   - 15.10 Quels droits donne-t-on
   - 15.11 Importance de l’ordre d’interprétation
   - 15.12 Contrôle de l’interprétation
   - 15.13 Limites
      - 15.13.1 Types
         - a) Soft
         - b) Hard
      - 15.13.2 Genres
         - a) Taille
         - b) Temps
   - 15.14 Résumé
- 16 Liste commande utile
- 17 Conclusion


## 1 Introduction

Voici le contenu du module :

- Faire connaissances avec les différentes notions et concepts associés aux annuaires
- Se familiariser avec les outils/clients d’administration de OpenLDAP
    o Outils en ligne de commande (ldapsearch, ldapmodify, etc)

```
o Outils graphiques (ldapBrowser, phpldapadmin)
```
- Comprendre les différents aspects entrant en ligne de compte dans un concept
    d’annuaire.
- Expérimenter et documenter les différentes techniques permettant de déléguer (re-
    ferals) et synchroniser (replication) les annuaires ou branches d’annuaires
       o Expérimenter et documenter des referals
       o Expérimenter et documenter des replications
- Expérimenter et documenter les ACLs et limites afin de contrôler l’accès à tout ou
    partie d’un annuaire
- Installer un système complet représentant une infrastructure LDAP
- Rédiger une documentation claire reprenant les éléments clé :

```
o Concepts de base
```
```
o Outils et clients LDAP
o Referals
```
```
o Replication
o ACLs et limites
o Procédures et protocoles de tests
```
## 2 Annuaire

### 2.1 Qu’est - ce que c’est?

- C’est une base de données hiérarchisée.
- Un conteneur d’information organisées

#### 2.1.1 Exemple

- L’annuaire téléphonique
- Les annuaires professionnels
- Les catalogues
- Les guides

### 2.2 Un annuaire électronique

#### 2.2.1 Qu’est-ce que c’est?


C’est un service qui offre un accès à des données relatives à des personnes ou à divers élé-
ments structurant d’une organisation.

**Un service d’annuaire** :

- Un protocole qui permet l’accès au contenu
- Une syntaxe qui permet d’interroger la base
- Un modèle de distribution des données
- Un modèle de duplication

### 2.3 Données d’entreprises et annuaire

Dans une entreprise, on considère 3 types de données. On parle de données de production, de
données non structurées et de données de références

Les annuaires électroniques sont adéquats pour gérer les données de références.

### 2.4 Données d’entreprises

#### 2.4.1 Données de production

- Produites par les applications
- Données structurées et typées, dépendantes des applications → donc peu parta-
    geables.

Exemple :

- Nomenclatures de production, liste de montage
- Données de facturation

Les données de production sont gérées essentiellement au moyen de bases de données rela-
tionnelles, qui permettent de réaliser des liens entre les différentes tables

#### 2.4.2 Données non structurées, connaissances

- Documents, notes, messages

Exemple :

- Logiciel de groupware comme les messageries et l’agenda.
- Traitements de texte, tableurs

Ces données sont très diverses, peu structurées et faiblement typées. La gestion de ces don-
nées est peu automatisable... elles se retrouvent souvent dans les partages de données ou
même les répertoires personnels des utilisateurs. La tendance consiste à déployer des logiciels
de fédération de ces données au niveau de l’entreprise, par exemple sharepoint, Zimbra,
Teams

#### 2.4.3 Données référence

- Données typées et structurées
- Hautement partagées
- Accédées essentiellement en lecture

Exemple :

- Base de données des utilisateurs d’un domaine informatique


- Données de configuration d’une application
- Liste de contrôle d’accès (ACL)
- Liste des machines d’un réseau

Ces données sont la cible idéale pour les systèmes d’annuaires. Les données de références
sont utilisées par de nombreux systèmes et processus (p.ex. l’authentification). Les données
sont essentiellement mises à jour dans le cadre d’opérations d’administration (p.ex. arrivée ou
départ d’un employé)

### 2.5 Objectifs de mise en place d’un annuaire

- Limiter les types de bases de données pour les données de référence (standardiser)
- Limiter le nombre de bases de données qui stockent des données de référence (centra-
    liser)
- Faire en sorte que les applications ne gèrent plus elles-mêmes les données de réfé-
    rence
- Eviter de stocker des données de production dans les annuaires

### 2.6 Comparatif annuaire et base de données

- L’annuaire est essentiellement accédé en lecture.
- L’annuaire est très performant en lecture et médiocre en écriture
- Les annuaires sont facilement extensibles
- Les données peuvent être distribuées plus facilement entre serveurs pour les annuaires
    (on évite la centralisation contrairement aux bases de données relationnelles)
- Les données d’un annuaire peuvent être dupliquées plus facilement avec les annuaires
    (performance, fiabilité, proximité des clients)
- Les annuaires sont basés sur le standard LDAP
- Les annuaires ne permettent pas d’établir des relations complexes entre objets
Caractéristique Base de données relation-
nelle

```
Annuaire
```
```
Relations entre objets Complexes et orientées mé-
tiers
```
```
Aucune (éventuellement hié-
rarchique)
```
```
Schéma 100% spécifique de l’utilisa-
tion
```
```
Standardisé
```
```
Répartition Centralisation Distribution
```
```
Transactions Oui Non
```
### 2.7 Exemple de données

- Certificats d’une PKI
- Carnet d’adresses
- Comptes d’utilisateurs
- Bibliothèque de musique
- Filmothèque
- Absences des élèves à l’EMF


- Les carnets de notes des élèves
- Liste des élèves et leurs coordonnées
- Annuaires professionnels
- Pages Jaunes

### 2.8 Caractéristiques des annuaires

**Les données d’annuaire doivent pouvoir** être lues rapidement

- Performance, optimisation des vitesses d’accès en lecture (structure des données en
    arbre)
- Disponibilités. Les données peuvent être distribuées (à proximité) et répliquées.
- Sécurité. Les accès aux objets de l’annuaire peuvent être gérés par des listes de con-
    trôle d’accès (Active Directory)
- Adaptabilité. Les schémas d’annuaire peuvent s’étendre aux besoins spécifiques de
    l’entreprise
- Extensibilité. L’annuaire est extensible (LDAPv3) Possibilité d’ajouter de nouvelles opé-
    rations aux opérations standards.

### 2.9 Exemple d’annuaire (DNS)

DNS (Domain Name System) est un système d’annuaire permettant d’établir un lien entre les
noms de machines ou de domaines et les adresses IP et vice versa.
Le système DNS est basé sur le principe client/server
L’information dans les DNS est structurée sous forme d’un arbre inversé et est distribué. Une
entité est responsable d’un nœud de l’arbre et connaît les nœuds immédiatement en dessous

Plusieurs serveurs (root servers) connaissent les adresses des serveurs DNS capables de ré-
pondre aux requêtes des TLD (Top Level Domain)
A leur tous ces serveurs connaissent les adresses des machines situés dans leurs domaines
Une requête se traduit par une succession de requête à des serveurs différents qui donneront
finalement l’adresse souhaitée

### 2.10 Le standard LDAP

**LDAP est un standard d’annuaire** réseau qui définit :

- Un protocole d’accès aux données. C’est un protocole applicatif client/server
- Un modèle de données qui détermine l’organisation logique des informations dans l’an-
    nuaire
- Un modèle fonctionnel qui définit les types d’opérations qu’il est possible d’effectuer sur
    l’annuaire


- Un modèle de distribution qui spécifie comment répartir l’information sur plusieurs ser-
    veurs
- Un modèle de sécurité qui indique comment protéger l’annuaire des attaques
- Un format d’échange (LDIF)

#### 2.10.1 DIT (Directory Information Tree)

**Les données de l’annuaire sont organisées en arbre. Le DIT.**

- La racine → Directory suffix
- L’arbre est constitué de feuilles et de **nœuds** → DSE (Directory Service Entry)
- La racine forme le contexte de nommage.

#### 2.10.2 DIB (Directory Information Base)

Toutes les informations qui se trouvent dans un annuaire sont définies sous la forme
**DIB. Les données sont disponibles sous la forme d’objets**

## 3 Exercice 1

### 3.1 Installation du serveur LDAP

```
#apt install slapd
#apt install ldap-utils
```
### 3.2 Créer un annuaire


Pour créer un annuaire, il faut tout d’abord tapper la commande :
**#dpkg-reconfigure slapd**

```
Ci-dessous, nous devons indiquer le suffix, le nom, le mot de passe ainsi que supprimé l’an-
cienne base de données.
```

On peut aussi changer dans le document /etc/host :

```
127.0.1.1 nom_d’hote.example.com nom_d’hote
```
### 3.3 L’ajout d’entrée

#### 3.3.1 Création d’un fichier config.ldif

Ce fichier, contient nos divers Organizational Units, des Canonical Name ou encore des utilisa-
teurs.

Voici un exemple pour le fichier add_content.ldif :

#### 3.3.2 Appliquer la config

Pour appliquer cette configuration, on utilise la commande ldapadd.

```
ldapadd -x -D cn=admin,dc=example,dc=com -W -f add_content.ldif
```

```
A l’exécution de cette commande, le mot de passe nous sera demande puis l’application de-
vrait s’effectuer correctement.
```
#### 3.3.3 Contrôle et résolution de problème

Lorsque nous avons un problème, nous pouvons soit reconfigurer directement la BD avec dkpg-
reconfigure soit changer sa configuration en modifiant l’objet. Pour effectuer une vérification on
peut utiliser la commande ldapsearch.

```
ldapsearch -x -LLL -b dc=example,dc=com ‘uid=john’ cn gidNumber
```
```
Explication de la commande :
```
- La liaison « simple » -x: ; n'utilisera pas la méthode SASL par défaut
- - LLL: (optionnel) désactive les informations externes d'impression
- uid=john : un « filtre » pour trouver l'utilisateur john
- cn gidNumber : demande l'affichage de certains attributs (la valeur par défaut fait
    s'afficher tous les attributs)

## 4 Exercice 2a

### 4.1 ApacheDirectoryStudio

#### 4.1.1 Documentation

Le projet a démarré en octobre de 2002 sous le nom de LDAPd par Alex Karasulu. L’objectif
était de développer un serveur LDAP en y ajoutant des fonctionnalités étendues comme les tig-
gers, procédures stockées. En octobre de 2003 le code fut donné à Apache Software Founda-
tion ou il est promu au stade de Top Level Project en octobre de 2004. La première version fut
annoncée en octobre 2006.


#### 4.1.2 Sources

https://fr.wikipedia.org/wiki/Apache_Directory

#### 4.1.3 Procédures d’installation..................................................................................

```
#apt install default-jdk
#apt install apache
#apt install default-jre
```
### 4.2 Phpldapadmin

#### 4.2.1 Documentation

C’est une interface écrite en PHP qui permet de modifier facilement un annuaire LDAP. Il fonc-
tionne comme phpMyAdmin pour les bases de données MySQL.


#### 4.2.2 Sources

https://fr.wikipedia.org/wiki/PhpLDAPadmin

### 4.3 JXplorer

#### 4.3.1 Documentation

C’est un navigateur open-source qui permet comme apacheds d’éditer une base de données
LDAP. Il est écrit en Java.

#### 4.3.2 Sources

https://en.wikipedia.org/wiki/JXplorer

### 4.4 LDAP admin

#### 4.4.1 Documentation


C’est un outil gratuit et open-source qui permet de manager des dossiers LDAP. Il a été créé en
2003 et écrit avec le langage Delphi.

#### 4.4.2 Sources

https://en.wikipedia.org/wiki/LDAP_Admin

### 4.5 Consigne

Consultez les données les données du DIT dc=example,dc=com au moyen du browser.

Vous reconfigurez votre service slapd pour que ce dernier ait les caractéristiques suivantes :

Note : vous allez perdre le DIT example.com

Domaine classe300221.ch
Donc suffixe de votre annuaire : dc=classe300221,dc=ch
Type de DB : mdb
Schéma d’annuaire : inetOrgPerson
Protocol ldapv2 : set to inactive
Mot de passe de l’admin de l’annuaire : Passw0rd
**#dpkg-reconfigure slapd**

#### 4.5.1 Nouveau document add_content.ldif..............................................................

```
dn: ou=eleves,dc=classe300221,dc=ch
objectClass: organizationalUnit
ou: eleves
```
```
dn: uid=danilo,ou=eleves,dc=classe300221,dc=ch
objectClass: inetOrgPerson
cn: Anzile Danilo
```

```
mail: anziled@studentfr.ch
sn: Anzile
```
```
dn: uid=paulo,ou=eleves,dc=classe300221,dc=ch
objectClass: inetOrgPerson
cn: Venancio Paulo
sn: Venancio
uid: paulo
```
```
dn: uid=julie,ou=eleves,dc=classe300221,dc=ch
objectClass: inetOrgPerson
cn: Bersier Julie
sn: Bersier
```
```
dn: uid=joel,ou=eleves,dc=classe300221,dc=ch
objectClass: inetOrgPerson
cn: Carman Joel
sn: Carman
```
```
dn: uid=jeremie,ou=eleves,dc=classe300221,dc=ch
objectClass: inetOrgPerson
cn: Favre Jeremie
sn: Favre
```
```
dn: uid=gael,ou=eleves,dc=classe300221,dc=ch
objectClass: inetOrgPerson
cn: Perroud Gael
sn: Perroud
```
### 4.6 Ajouter

Pour rajouter une nouvelle entrée, on doit le faire a l’aide d’un fichier ldif puis l’envoyé dans la
BD.

#### 4.6.1 Commande

```
#ldapadd -x -D cn=admin,dc=classe300221,dc=ch -W -f add_content.ldif
```
#### 4.6.2 Résultat


### 4.7 Modifier

Pour effectuer une modification, on doit utiliser le changetyp : modify.

#### 4.7.1 Ajouter une modification

En utilisant le mot clé add, on peut ajouter des modifications comme on peut le voir dans
l’exemple ci-dessous.

#### 4.7.2 Appliquer les modifications

Pour appliquer les modifications, on utilise la commande ldapmodify.

```
#ldapmodify -x -D cn=admin,dc=classe300221,dc=ch -W -f
add_modify_content.ldif
```

### 4.8 Remplacer

Le fonctionnement et plus ou moins le même qu’au point précédent, cependant au lieu d’utilisé
add, on utilise replace.
Voici un exemple :

#### 4.8.1 Commande

```
#ldapmodify -x -D cn=admin,dc=classe300221,dc=ch -W -f modify_content.ldif
```
### 4.9 Supprimer

Pour supprimer une entrée, il suffit de d’utiliser le changetype : modify.

Exemple pour toutes les valeurs :

Exemple pour une seul :

#### 4.9.1 Commande

```
#ldapmodify -x -D cn=admin,dc=classe300221,dc=ch -W -f modify_content.ldif
```
### 4.10 Fonctionnement ADS

#### 4.10.1 Connection


#### 4.10.2 Options disponibles

#### 4.10.3 Ajouter à l’aide d’apache


#### 4.10.4 Supprimer à l’aide d’apache

#### 4.10.5 Console

Nous avons une console en bas de l’écran qui nous montre ce qu’il a fait.

## 5 Exercice 2b

### 5.1 Ajout d’un nouveau module

De base le module mdb est déjà installer et enregistrer sous /usr/lib/ldap et il se trouve sous le
nom de module{0}.

#### 5.1. 1 Ajout d’un module HDB

```
dn: cn=module,cn=config
changetype: add
objectClass: olcModuleList
cn: module
olcModuleLoad: back_hdb
olcModulePath: /usr/lib/ldap
```
#### 5.1.2 Commande

```
#ldapadd -Y EXTERNAL -H ldapi:/// -f add_module_hdb.ldif
```

### 5.2 Ajout d’un DIT

```
dn: olcDatabase=hdb,cn=config
changetype: add
objectClass: olcDatabaseConfig
objectClass: olcHdbConfig
olcDatabase: hdb
olcDbDirectory: /var/lib/ldap/garages
olcSuffix: dc=garages,dc=ch
olcAccess: {0}to attrs=userPassword by self write by anonymous auth by *
none
olcAccess: {1}to attrs=shadowLastChange by self write by * read
olcAccess: {2}to * by * read
olcLastMod: TRUE
olcRootDN: cn=admin,dc=garages,dc=ch
olcRootPW: {SSHA}VYTMoa0gJbZ7uw6sou0gsbwDKHAtuUcX
olcDbCheckpoint: 512 30
olcDbIndex: objectClass eq
olcDbIndex: cn,uid eq
olcDbIndex: uidNumber,gidNumber eq
olcDbIndex: member,memberUid eq
```
#### 5.2.1 Commande

```
#ldapmodify -Y EXTERNAL -H ldapi:/// -f add_DIT.ldif
```
### 5.3 Organisation du DIT

```
#ajout organisation
dn: dc=garages,dc=ch
changetype: add
objectClass: top
objectClass: dcObject
objectClass: organization
o: garages
dc: garages
```
```
#ajout admin
dn: cn=admin,dc=garages,dc=ch
changetype: add
objectClass: simpleSecurityObject
objectClass: organizationalRole
cn: admin
description: LDAP administrator
userPassword: {SSHA}ZRdn2RN1d9UWm+pUY1FsT4EoQQt7pU8v
```
Ici, nous ajoutons une organisation et un admin qui peut se connecter à la base de données.
Il ne faut pas oublier de changer les valeurs du DIT et le nom de l’admin

#### 5.3.1 Ajout des diverses données dans le nouveau DIT

```
dn: cn=auto m,ou=lesgarages,dc=garages,dc=ch
changetype: add
objectClass: inetOrgPerson
cn: auto m
sn: garage auto m
labeledURI: https://garage-auto-m.business.site/
mail: ilsenontpas@gmail.com
postalAddress:: Q2hlbWluIE1vbnPDqWpvdXIgMTkkMTcwMCBGcmlib3VyZyRTdWlzc2U=
telephoneNumber: 026 558 98 52
telephoneNumber: 077 946 08 63
```
```
dn: cn=des grives,ou=lesgarages,dc=garages,dc=ch
changetype: add
```

```
objectClass: inetOrgPerson
cn: des grives
sn: garage des grives
labeledURI: https://www.garagedesgrives.ch/
mail: garagedesgrives@bluewin.ch
postalAddress: Route des Grives 4, 1763 Granges-Paccot
telephoneNumber: 079 441 07 32
```
```
dn: cn=de la gerine morina,ou=lesgarages,dc=garages,dc=ch
changetype: add
objectClass: inetOrgPerson
cn: de la gerine morina
sn:: Z2FyYWdlIGRlIGxhIGdlcmluZSBtb3JpbmEg
labeledURI: https://www.local.ch/fr/d/marly/1723/garage-de-la-gerine-morina-
7iWu2a6jjFvG996y7XSuKg
mail: ilsenontpas@gmail.com
postalAddress:: Um91dGUgZGUgQ2jDqXNhbGxlcyA1NCwgMTcyMyBNYXJseQ==
telephoneNumber: 026 436 21 04
```
## 6 Exercice 3b

### 6.1 Mise en place de la réplication (dc=ga-

### rages,dc=ch)

#### 6.1.1 Configuration du provider

On doit faire attention a quel module on charge le nouveau module syncprov. Dans ce cas, je
l’ai appliquer au module{1} vu que c’est mon module hdb soit celui que je veux synchroniser.

```
dn: cn=module{1},cn=config
changetype: modify
add: olcModuleLoad
olcModuleLoad: {1}syncprov
```
#### 6.1.2 Commande

Voici la commande pour appliquer les changements :

```
#ldapmodify -Y EXTERNAL -H ldapi:/// -f ADD_SYNCPROV
```
#### 6.1.3 Configuration du consumer

##### a) La BD

Tout d’abord, nous devons ajouter une base de données de type hdb qui va accueillir la réplica-
tion.
Ce qu’il ne faut pas oublier c’est de créer le répertoire /var/lib/ldap/garages avant d’executer le
fichier ldif.

```
dn: cn=module,cn=config
changetype: add
objectClass: olcModuleList
cn: module
olcModuleLoad: back_hdb
olcModulePath: /usr/lib/ldap
```
```
dn: olcDatabase=hdb,cn=config
changetype: add
objectClass: olcDatabaseConfig
objectClass: olcHdbConfig
olcDatabase: hdb
```

```
olcDbDirectory: /var/lib/ldap/garages
olcSuffix: dc=garages,dc=ch
olcAccess: {0}to attrs=userPassword by self write by anonymous auth by *
none
olcAccess: {1}to attrs=shadowLastChange by self write by * read
olcAccess: {2}to * by * read
olcLastMod: TRUE
olcRootDN: cn=admin,dc=garages,dc=ch
olcRootPW: {SSHA}VYTMoa0gJbZ7uw6sou0gsbwDKHAtuUcX
olcDbCheckpoint: 512 30
olcDbIndex: objectClass eq
olcDbIndex: cn,uid eq
olcDbIndex: uidNumber,gidNumber eq
olcDbIndex: member,memberUid eq
```
Pour appliquer ces changements, on utilise la commande :

```
#ldapmodify -Y EXTERNAL -H ldapi:/// -f CONF_SYNCPROV.ldif
```
##### b) Synchronisation du service

```
dn: olcDatabase={2}hdb,cn=config
changetype: modify
add: olcSyncrepl
olcSyncrepl: rid=101 provider="ldap://192.168.127.10/"
type=refreshAndPersist retry="60 30 300 +" searchbase="dc=garages,dc=ch"
bindmethod=simple binddn="cn=admin,dc=garages,dc=ch" credentials=Passw0rd
```
Pour appliquer ces changements, on utilise la commande :

```
#ldapmodify -Y EXTERNAL -H ldapi:/// -f CONF_SYNCPROV.ldif
```
#### 6.1.4 Test de la synchronisation

Pour tester le fonctionnement de la synchronisation, j’ai ajouté un nouveau garage.

```
dn: cn=garage prez,ou=lesgarages,dc=garages,dc=ch
changetype: add
objectClass: inetOrgPerson
cn: Garage Prez
sn: Garage Prez
labeledURI: https://www.garageprez.ch/
mail: garageprez@gmail.ch
postalAddress: Chemin des vergers 9, 1746 Prez
telephoneNumber: 07 9 244 57 40
```
Pour appliquer ces changements, on utilise la commande :

```
#ldapmodify -D cn=admin,dc=garages,dc=ch -W -H ldapi:/// -f
ajout_garage.ldif
```
## 7 Exercice 3d

### 7.1 La délégation LDAP

Le but de la délégation est de répartir une partie d’un DIT a un autre serveur LDAP ce qui per-
met d’avoir une répartition de charge et tolérance de panne.

Le composant utilisé pour faire cela est le module back_ldap.


Les notions importantes sont :

- DN : Distinguished Name
- RDN : Relative Distinguished Name

#### 7.1.1 Fonctionnement

Il existe de type de délégation. La première est le « Referral » et la deuxième est le « Referral +
Chaininh ».

##### a) Referral

Le referral va juste faire une redirection vers le serveur où se trouve le DIT.

##### b) Referral + Chaining

Au lieu de rediriger il l’affiche directement.

### 7.2 Ajout d’une nouvelle BD et d’un DIT

#### 7.2.1 Création base de données

```
dn: olcDatabase=mdb,cn=config
changetype: add
objectClass: olcDatabaseConfig
objectClass: olcMdbConfig
olcDatabase: mdb
olcDbDirectory: /var/lib/ldap
olcSuffix: dc=classe300221,dc=ch
olcAccess: {0}to attrs=userPassword by self write by anonymous auth by *
none
olcAccess: {1}to attrs=shadowLastChange by self write by * read
olcAccess: {2}to * by * read
olcLastMod: TRUE
olcRootDN: cn=admin,dc=classe300221,dc=ch
olcRootPW: {SSHA}VYTMoa0gJbZ7uw6sou0gsbwDKHAtuUcX
olcDbCheckpoint: 512 30
olcDbIndex: objectClass eq
olcDbIndex: cn,uid eq
olcDbIndex: uidNumber,gidNumber eq
olcDbIndex: member,memberUid eq
```
##### a) Commande

```
#ldapmodify -Y external -H ldapi:/// -f addNewDB.ldif
```
#### 7.2.2 Création du DIT

```
dn: dc=classe300221,dc=ch
changetype: add
objectClass: top
objectClass: dcObject
objectClass: organization
o: classe300221
dc: classe300221
```
```
#ajout admin
dn: cn=admin,dc=classe300221,dc=ch
changetype: add
objectClass: simpleSecurityObject
objectClass: organizationalRole
cn: admin
```

```
description: LDAP administrator
userPassword: {SSHA}ZRdn2RN1d9UWm+pUY1FsT4EoQQt7pU8v
```
##### a) Commande

```
#ldapmodify -D cn=admin,dc=classe300221,dc=ch -H ldapi:/// -f addNewDIT.ldif
```
### 7.3 Ajouter une nouvelle localité

```
dn: l=Prez,dc=garages,dc=ch
changetype: add
objectClass: locality
l: Prez
```
### 7.4 Ajouter des nouveaux utilisateurs et une OU

```
dn: ou=grp2,dc=classe300221,dc=ch
changetype: add
objectClass: organizationalUnit
ou: Grp2
```
```
dn: cn=anzile,ou=grp2,dc=classe300221,dc=ch
changetype: add
objectClass: InetOrgPerson
ou: grp2
uid: anzile
cn: anzile
sn: anzile
```
```
dn: cn=bersier,ou=grp2,dc=classe300221,dc=ch
changetype: add
objectClass: InetOrgPerson
ou: grp2
uid: bersier
cn: bersier
sn: bersier
```
```
dn: cn=carman,ou=grp2,dc=classe300221,dc=ch
changetype: add
objectClass: InetOrgPerson
ou: grp2
uid: carman
cn: carman
sn: carman
```
#### 7.4.1 Commande

```
#ldapmodify -D cn=admin,dc=classe300221,dc=ch -H ldapi:/// -f
add_3usr_1ou.ldif
```
### 7.5 Indiquer la référence

```
dn: ou=grp2,dc=classe300221,dc=ch
changetype: add
objectClass: referral
objectClass: extensibleObject
ou: grp2
ref: ldap://192.168.127.131/ou=grp2,dc=classe300221,dc=ch
```
#### 7.5.1 Commande


```
#ldapmodify -D cn=admin,dc=classe300221,dc=ch -H ldapi:/// -f
addReference.ldif
```
### 7.6 Le chainage

#### 7.6.1 Ajouter le module...........................................................................................

Dans ce cas, on ajoute ce module a notre base classe300221. Si on souhaite déléguer une
autre base de données, il faut changer le module avec celui de l’autre BD.

```
dn: cn=module{0},cn=config
changetype: modify
add: olcModuleLoad
olcModuleLoad: back_ldap
```
##### a) Commande

##### a) Commande

```
#Ldapmodify -Y EXTERNAL -H ldapi:/// -f addModuleDelegation.ldif
```
#### 7.6.2 Mise en place

```
dn: olcOverlay=chain,olcDatabase={-1}frontend,cn=config
objectClass: olcOverlayConfig
objectClass: olcChainConfig
olcOverlay: chain
olcChainCacheURI: FALSE
olcChainMaxReferralDepth: 2
olcChainReturnError: TRUE
```
```
dn: olcDatabase=ldap,olcOverlay={0}chain,olcDatabase={-1}frontend,cn=config
objectClass: olcLDAPConfig
objectClass: olcChainDatabase
olcDatabase: ldap
```
a) Commande

```
#ldapadd -Y EXTERNAL -H ldapi:/// -f configChaine.ldif
```
#### 7.6.3 Slapd

##### a) Arrêt du service

```
#service slapd stop
```
##### b) Import du fichier ldif

```
#slapadd -b cn=config -l defaultldap.ldif
```
Defaultldap.ldif
→
**dn: olcDatabase=ldap,olcOverlay={0}chain,olcDatabase={-1}frontend,cn=config
objectClass: olcLDAPConfig
objectClass: olcDatabaseConfig
objectClass: olcConfig
objectClass: top
objectClass: olcChainDatabase
olcDatabase: ldap
olcDbURI: ldap://192.168.127.131/**

Serveur REFERRAL : C’est le serveur sur lequel on va envoyer la config.


##### c) Suppression d’une entrée

```
#rm /etc/ldap/slapd.d/cn\=config/olcDatabase\=\{- 1 \}over.ldif
```
##### d) Modification des permissions

```
#chown -R openldap:openldap /etc/ldap/slapd.d/cn\=config
```
##### e) Démarrage du service

```
#service slapd start
```
#### 7.6.4 Test

On peut tester de deux façons. La première c’est en passant par Apache Directory Studio et la
deuxième c’est en tapant la commande :

```
ldapsearch -x -D cn=admin,dc=classe300221,dc=ch -b
ou=grp2,dc=classe300221,dc=ch -H ldapi:/// -W
```
## 8 Exercice 3e

### 8.1 Etape pour répliquer un nouveau DIT

#### 8.1.1 Syncprov (provider)

Etape à faire qu’une seul fois sur le provider même si on réplique plusieurs BD de différents
modules.
**dn: cn=module{0},cn=config
changetype: modify
add: olcModuleLoad
olcModuleLoad: {1}syncprov**

##### a) Commande

```
ldapmodify -Y external -H ldapi:/// -f addModule.ldif
```
#### 8.1.2 Configuration du syncprov

```
dn: olcDatabase=mdb,cn=config
changetype: add
objectClass: olcDatabaseConfig
objectClass: olcMdbConfig
olcDatabase: mdb
olcDbDirectory: /var/lib/ldap
olcSuffix: dc=classe300221,dc=ch
olcAccess: {0}to attrs=userPassword by self write by anonymous auth by *
none
olcAccess: {1}to attrs=shadowLastChange by self write by * read
olcAccess: {2}to * by * read
olcLastMod: TRUE
olcRootDN: cn=admin,dc=classe300221,dc=ch
olcRootPW: {SSHA}VYTMoa0gJbZ7uw6sou0gsbwDKHAtuUcX
olcDbCheckpoint: 512 30
olcDbIndex: objectClass eq
olcDbIndex: cn,uid eq
olcDbIndex: uidNumber,gidNumber eq
olcDbIndex: member,memberUid eq
```

##### a) Commande

```
ldapmodify -Y external -H ldapi:/// -f addDB.ldif
```
#### 8.1.3 Lien avec le consumer

##### a) Commande qui permet de trouver la DB

```
ldapsearch -Y external -H ldapi:/// -b cn=config
```
```
dn: olcDatabase={3}mdb,cn=config
changetype: modify
add: olcSyncrepl
olcSyncrepl: rid=102 provider="ldap://192.168. 153. 160 /"
type=refreshAndPersist retry="60 30 300 +"
searchbase="dc=classe300221,dc=ch" bindmethod=simple
binddn="cn=admin,dc=classe300221,dc=ch" credentials=Passw0rd
```
##### b) Commande execution

```
ldapmodify -Y external -H ldapi:/// -f syncCreation.ldif
```
### 8.2 Réplication de l ’ arbre cn=config vers le consu-

### mer

```
dn: olcOverlay={0}syncprov,olcDatabase={0}config,cn=config
changetype: add
objectClass: olcOverlayConfig
objectClass: olcSyncProvConfig
olcOverlay: {0}syncprov
olcSpCheckpoint: 20 60
olcSpSessionlog: 1000
# Sync Checkpoints tous les 20 changements ou tous les 60 minutes
# Le nombre d'opérations dans le log
```
#### 8.2.1 Commande

```
ldapmodify -Y external -H ldapi:/// -f configurationSyncprovCnConfig.ldif
```
## 9 Exercice 4

### 9.1 Ajout du contenu

```
dn: ou=groups,dc=classe300221,dc=ch
changetype: add
objectClass: organizationalUnit
ou: groups
dn: ou=people,dc=classe300221,dc=ch
changetype: add
objectClass: organizationalUnit
ou: people
dn: cn=mymanager,ou=people,dc=classe300221,dc=ch
changetype: add
Objectclass : InetOrgPerson
ou: people
uid: mymanager
cn: mymanager
sn: mymanager
dn: cn=myboss,ou=people,dc=classe300221,dc=ch
changetype: add
Objectclass : InetOrgPerson
```

```
ou: people
uid: myboss
cn: myboss
sn: myboss
dn: cn=managers,ou=groups,dc=classe300221,dc=ch
changetype: add
objectClass: groupOfNames
ou: groups
cn: managers
member: cn=mymanager,ou=people,dc=classe300221,dc=ch
```
#### 9.1.1 Commande

```
#ldapmodify -x -D cn=admin,dc=classe300221,dc=ch -W -f ajout_contenu.ldif
```
### 9.2 Ajout de l’acl

```
dn: olcDatabase={1}mdb,cn=config
changetype: modify
replace: olcAccess
olcAccess: {0}to attrs=userPassword by self write by anonymous auth by *
none
olcAccess: {1}to attrs=shadowLastChange by self write by * read
olcAccess: {2}to filter="(objectClass=inetOrgPerson)" by
group.exact="cn=managers,ou=groups,dc=classe300221,dc=ch" read by * none
olcAccess: {3}to * by * read
```
#### 9.2.1 Commande

```
#ldapmodify -Y EXTERNAL -H ldapi:/// -f ajout_olcAccess-managers.ldif
```
### 9.3 Exemple ACL

9.3.1 Limiter accès attribut « userPassword »

```
olcAccess: to attrs=userPassword
by self write
by group.exact="cn=ADMIN,ou=groups,dc=example,dc=com" write
by anonymous auth
by * none
```
## 10 Connection cn=config

### 10.1 Fichier LDIF

```
# Ajout cn=admin dans .config database
```
```
dn: olcDatabase={0}config,cn=config
changetype: modify
add: olcRootDN
olcRootDN: cn=admin,cn=config
```
**-
add: olcRootPW
olcRootPW: <mdp-hasher>**

10.1.1 <mdp-hasher>

A la place, nous devons mettre le mot de passe hacher qu’on obtient grâce a la commande
slappasswd.


a) Commande

```
# slappasswd >> fichier.ldif
```
### 10.2 Injection

Après avoir créer ce fichier LDIF, nous devons l’injecter à l’aide de la commande :
**# ldapmodify -Y EXTERNAL -H ldapi:/// -f 11-add-RootDN-RootPW-to-config.ldif**

### 10.3 Configuration Apache

10.3.1 Nouvelle connexion

## 10 Synchroniser les serveurs avec ntp

```
#apt install ntpdate
#vim /etc/default/ntpdate
```

## 11 Recherche dans LDAP

### 11.1 Mise en place de la commande

- ldapsearch
    o La commande principale
- - x
    o Y
- - b <base>
    o Le DIT que l’on veut explorer
- - D <user>
    o L’utilisateur qui va l’attaquer
- ‘<filtre>’
    o Filtres de recherche

### 11.2 Anonyme

```
#ldapsearch -x -b dc=classe300221,dc=ch -H ldapi:/// uid=diasmadeiral
```
### 11.3 Avec utilisateur

```
#ldapsearch -x -b dc=classe300221.dc=ch -D
cn=mymanager,ou=people,dc=classe300221,dc=ch -W -H ldapi:///
uid=diasmadeiral
```
## 12 Exercice supplémentaire

Connecter depuis un serveur linux vers un serveur Windows, pour récupérer la base de don-
nées utilisateur. Pour trouver le DN (Distinguish Name) on peut utiliser l’application LDP.exe qui
est installer par défaut sur Windows.
Voici la commande pour attaquer la base depuis linux :

```
#ldapsearch -x -D cn=adm-gremaud,cn=users,dc=lan,dc=local -w Emf12345 -b
dc=lan,dc=local -H ldap://192.168.153.240
```
## 13 Répliquer un service d’annuaire

### 13.1 Concept


#### 13.1.1 But

Le but est de conserver en parfaite synchronisation plusieurs DIT répartis sur le réseau.

#### 13.1.2 Référence

Protocole de réplication RFC 4533

#### 13.1.3 Composant Openldap

Overlay module « sncprov »

#### 13.1.4 Information importante

Les serveurs doivent impérativement être synchroniser avec un serveur NTP.

### 13.2 Modes de réplication

Il existe deux modes de réplication sont disponibles :

- Maître-esclave
    o Maître nommé « provider »
    o Esclave nommé « consumer »
- Multi-Master
    o Chaque server est provider et consumer

## 14 Configurer un referral

### 14.1 Concept

- Le but est de déléguer une partie d’un DIT sur un autre serveur LDAP.
- Composant : module back_ldap
- Notions importantes :
    o DN : Distinguished Name
    o RDN : Relative Distinguished Name
- Important : Les serveurs doivent être synchroniser temporellement parlant.
- Différence importante entre LDAP et BD transactionnelle :
    o Lorsqu'une mise à jour est effectuée sur un annuaire maître LDAP, il peut pren-
       dre un certain temps (en termes de traitement) pour mettre à jour tous les es-
       claves.
    o Le maître et les esclaves peuvent être désynchronisé pour une certaine période.
       Dans le cas d’un referral avec chainage, si les DIT sont répliqués, cela peut faire
       croire à un mauvais fonctionnement.


### 14.2 Fonctionnements possibles

- Referral :
    o Une requête sur un enregistrement de type referral retourne l’adresse du serveur
       hébergeant cette partie du DIT.
    o Similaire à une requête DNS itérative
- Referral + Chaining :
    o Une requête sur un enregistrement de type referral retourne le résultat tel qu’il
       est enregistré dans la partie déléguée du DIT.
    o Similaire à une requête DNS récursive

### 14.3 Mise en place

- Communication :
    o Les annuaires Open LDAP utilisent le port TCP 389 par défaut
    o Dans un environnement de production, on rajoute une couche SSL qui utilise le
       port 636. Ne pas oublier de configurer le firewall

#### 14.3.1 Exemple de DIT

15.3.2 DIT referral


#### 14.3.3 Explication

- L’attribut ref indique où se trouve la partie déléguée :
    dn: ou=ou3,dc=example,dc=com
    objectClass: referral
    objectClass: extensibleObject
    ou: ou3
    ref: ldap://<@IP_referral_srv>/ou=ou3,dc=example,dc=com
- La valeur de l’attribut ref est un chemin ldap
    ldap://<adresse ip ou nom dns><:port (optionnel, 389 par défaut)>/<dn>
- Ce referral est ajouté comme un autre objet du DIT.
    o L’enregistrement est affiché comme suit :
    # search reference
    ref: ldap://<@IP_referral_srv>/ /ou=ou3,dc=example,dc=com??sub
- Chargement du module back_ldap
    dn: cn=module{0},cn=config
    changetype: modify
    add: olcModuleLoad
    olcModuleLoad: back_ldap
- Configuration du « chain overlay » :
    dn: olcOverlay=chain,olcDatabase={-1}frontend,cn=config
    objectClass: olcOverlayConfig
    objectClass: olcChainConfig
    olcOverlay: chain
    olcChainCacheURI: FALSE
    olcChainMaxReferralDepth: 4
    olcChainReturnError: TRUE
- On précise la profondeur de « referral »,ici : 4


- Configuration « chain intercept configuration » : Etape 1
    dn: olcDatabase=ldap,olcOverlay={0}chain,olcDatabase={-1}frontend,cn=config
    objectClass: olcLDAPConfig
    objectClass: olcChainDatabase
    olcDatabase: ldap
- Cette configuration ldif doit être ajouté avec slapd
    o → arrêter le service slapd :
       ▪ Service slapd stop
    o → importer le fichier ldif :
       ▪ slapd -b cn=config -l defaultldap.ldif
    o → Suppression d’une entrée et modification de permissions :
       ▪ rm /etc/ldap/slapd.d/cn\=config/olcDatabase\=\{- 1 \}over.ldif
       ▪ chown -R openldap:openldap /etc/ldap/slapd.d/cn\=config
    o → Démarrage du service slapd :
       ▪ Service slapd start
- Configuration « chain intercept configuration » : Etape 2
    dn: olcDatabase=ldap,
    olcOverlay={0}chain,olcDatabase={-1}frontend,cn=config
    objectClass: olcLDAPConfig
    objectClass: olcDatabaseConfig
    objectClass: olcConfig
    objectClass: top
    objectClass: olcChainDatabase
    olcDatabase: ldap
    olcDbURI: ldap://<@IP_referral_srv>/
- Ensuite, redémarrage du service slapd

### 14.4 En résumé

- Bien comprendre le concept de Referral-Chaining
- Referral, l’équivalent du résultat d’une requête itérative
- Chaining, l’équivalent d’une requête récursive
- Configuration du chaining particulière, attention.

## 15 ACL

### 15.1 Concept ACL

#### 15.1.1 But

Le but est de configurer des droits d’accès sur les données d’un DIT.

#### 15.1.2 Composant

Le composant utilisé est le oclAccess.

#### 15.1.3 Notion importante

- DN = Distinguished Name
- Peut s’appliquer à divers éléments du DIT.
- Ordre significatif

#### 15.3.2 Syntaxe à respecter :


### 16.2 Concept Limite

16.2.1 But

Le but est de protéger un annuaire contre des accès massif, pour ce faire il faut configurer une
limite de taille aux résultats de recherche.

16.2.2 Composant

Attribut olcAccess

### 16.3 Concept index

16.3.1 But

Permet de définir des indexes pour accélérer la rercherche

16.3.2 Syntaxe à respecter :

```
olcDbIndex: attrlist | default indice
```
16.3.3 À faire attention

- Les indexes doivent être utilisés seulement pour des attributs fréquemment utilisés.
- Des indexes peu utilisés consomment des ressources (mémoire, cpu) et ralentissent les
    opérations en écriture

### 16.4 Rappelle arborescence cn=config

### 16.5 Element de syntaxe

16.5.1 Exemple

### Rappel : arborescence cn config


```
olcAccess: to <xxx> by <zzz> <droit>
```
16.5.2 olcAccess

Le nom de l’attribut.

16.5.3 To <xxx>

À quel élément s’applique la règle.

16.5.4 By <zzz>

À qui s’applique la règle

16.5.5 <droit>

Le droit qui s’applique (Write, Read, ...).

### 16.6 Règle d’utilisation

- TOUJOURS rechercher les droits actuels AVANT de les modifier
    (rappel : il est possible de rediriger l’affichage vers un fichier pour l’éditer ensuite)
- Utiliser la directive replace si possible
- Attention à l’ordre des attributs « olcAccess »
    - Slapd interprète chaque ligne jusqu’à ce qu’il y ait un match de la condition, et
       ignore les suivantes.
    - De même sur les différents éléments d’une ligne olcAccess

### 16.7 Exemple d’interprétation d’ACLs par slapd

### 16.8 Sur quoi donne t’on les droits?

###### 16.8.1 1

Exemple d interprétation d ACLspar slapd

```
Exemple (avec retours à la ligne pour la lisibilité):
olcAccess:
{ 0 }to attrs userPassword
by self write
by anonymous auth
by none
olcAccess:
{ 1 }to attrs shadowLastChange
by self write
by read
olcAccess:
{ }to dn.base
by read
olcAccess:
{ 3 }to
by dn cn admin,dc example,dc ch write
by read
```

###### 16.8.2 2

### 16.9 A qui donne-t-on des droits?

Sur quoi donne-t-on des droits 1

```
olcAccess: to xxx by < > <droit>
Par ex., sil annuairecontientles entrées suivantes:
0 : o example
1 : cn Manager,o example
: ou people,o example
3 : uid d ,ou people,o example
: cn addresses,uid d ,ou people,o example
: uid hyc,ou people,o example
Alors
to dn.base ou people,o example correspond au point
to dn.one ou people,o example correspond avec les points 3 , et
to dn.subtree ou people,o example correspond avec , 3 , , et
to dn.children ou people,o example correspond avec 3 , , et.
to dn.exact ou people,o example correspond au point Alias de
dn.base
```
```
10
```
Sur quoi donne-t-on des droits

olcAccess: **to xxx** by < > <droit>

```
to filter <ldapfilter> o <ldapfilter> estunechaine
représentantun filtrede rechercheLDAP
Par exemple:
to filter (objectClass person)
A noterilestpossible d utiliserDN et filter dansla clause :
to dn.one ou people,o suffix
filter (objectClass person)
Les attributssontspécifiésenles séparantpar des virgules
dansla clause. Il estaussipossible de définirunevaleur
pour un attribut.
attrs <attribute list>
attrs <attribute> val .<style> <regex>
```
```
11
```

### 16.10 Quels droits donne-t-on

### 16.11 Importance de l’ordre d’interprétation

- Les directives situées dans la Database sont interpétées avant celles situées dans {-
    1}frontend
- Les lignes olcAccess sont interprétées dans l’ordre.
- Les clauses olcAccess sont interprétées dans l’ordre de lecture
- → Placer les clauses restrictives en premier
- → Sinon, certaines ACL risquent d’être ignorées

A qui donne-t-on des droits

### olcAccess: to <xxx> b <droit>

```
1
```
```
Désignation Entité
Tousanonyme,y comprisetauthentifiésutilisateurs
```
```
anonymous (utilisateurs nonAnonymous-authentifiés)
users utilisateurs authentifiés
self Utilisateurassociéciblée à l^ entrée
```
```
dn .<basic-style> <regex> Utilisateursl expressioncorrespondantrégulière à
dn.<scope-style> <DN> Utilisateursdansla plagedu dn
```
```
Quels droits donne-t-on
```
```
olcAccess: to <xxx> by < > droit
```
```
Description des droits :
none 0 aucunaccès
disclose d information encasd erreur
auth dx authentification(bind)
compare cdx comparaison
search scdx utilisationde filtrede recherche
read rscdx lecture de résultatsde recherche
write wrscdxmodification/renommage
manage mwrscdx gestion
```
```
Chaqueniveauimpliquetousles niveauxprécédents
```
```
13
```

### 16.12 Contrôle de l’interprétation

### 16.13 Limites

16.13.1 Types

##### a) Soft

L’utilisateur ne peut la dépasser.

##### b) Hard

Le client LDAP peut spécifier une limite plus élevée que la limite soft et c’est la limite hard qui
s’appliquera.

16.13.2 Genres

##### a) Taille

olcSizeLimit qui correspond a la taille de la réponse.

##### b) Temps

olcTimeLimit qui correspond au temps nécessaire au serveur pour répondre.

```
Contrôle de l interprétation
```
```
olcAccess: to <xxx> by < > droits control
```
```
Description du control (qui prend la place du droit):
Stop
option par defaut, stoppel interprétationde la ligneolcAccess,
et n interprètepas les lignesolcAccesssuivantes
Continue
Continue l interprétationde la ligneolcAccesset des suivantes
Brea
stoppel interprétationde la ligneolcAccess, interprètesles
lignesolcAccesssuivantes
```
```
Exemple:
to <xxx> by brea permetde garantirun match pour interpréter
le brea et les lignesolcAccessqui suivent.
```
```
1
```

### 15.14 Résumé

- Bien comprendre leconcept olcAccess
- olcAccess pour protéger l’accès aux données
    o On définit les droits
    o Ordre d’execution très important.
- Limites pour protéger le service d’annuaire.

## 16 Liste commande utile

```
Commande Description
```
**#dpkg-reconfigue slapd** (^) Permet de reconfigurer slpad
**#ldapadd -x -D
cn=admin,dc=example,dc=com -W -
f add_content.ldif**
Permet de rajouter des nouvelles entrées
dans la base de données.
**# ldapsearch -Q -LLL -Y
EXTERNAL -H ldapi:/// -b
olcDatabase={0}config,cn=config**
Permet d’afficher ce que la base contient.

- - Q →
- - x → utilisation d’une authentification
    simple.
- - D → utilisation du dn pour se con-
    necter au ldpa directory
- - w → requière un mot de passe pour
    s’authentifier.
- - b → demande un point de base de
    recherche.
- - H → Exemple :

Limites

```
Si aucune limite n est configurée, les valeurs
globales sont :
olcSi eLimit 00 en nombre d entrées
olcTimeLimit 3 00 en secondes
```
```
Syntaxe :
```
```
olcLimits<who> <limit> <limit> ...
```
```
Exemples :
```
olcLimitsanonymous time

```
olcLimits
dn.exact cn anyuser,dc example,dc org
time.hard unlimited
```
```
1
```

- H ldap://192.168.153.240
**# ldapmodify -Y EXTERNAL -H
ldapi:/// -f add_database.ldif**

```
Permet de modifier la base de données en
rajoutant les utilisateurs dans la base.
```
## 17 Conclusion

Durant ce module, nous avons vu comment mettre en place un service d’annuaire sur un ser-
veur linux. Ce qui m’a plus, c’est que nous avons pu voir comment le protocole LDAP fonc-
tionne et voir comment il fonctionne.


